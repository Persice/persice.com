"use strict";angular.module("beKindred",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngResource","ngDraggable","ya.nouislider","angucomplete-alt","underscore","checklist-model"]).config(["$httpProvider","$resourceProvider",function(e,o){e.defaults.headers.patch={"Content-Type":"application/json;charset=utf-8"},o.defaults.stripTrailingSlashes=!1,e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken",e.defaults.headers.post={"Content-Type":"application/json;charset=utf-8"}}]).value("noUiSliderConfig",{step:1}).directive("ngEnter",function(){return function(e,o,t){o.bind("keydown keypress",function(o){13===o.which&&(e.$apply(function(){e.$eval(t.ngEnter)}),o.preventDefault())})}}).directive("endRepeat",["$timeout",function(e){return{restrict:"A",link:function(o){o.$last===!0&&e(function(){o.$emit("ngRepeatFinished")})}}}]),angular.module("beKindred").factory("GoalsFactory",["$resource",function(e){return e("/api/v1/goals/:goalId/:param",{goalId:"@goalId"},{query:{method:"GET",isArray:!1,cache:!1}})}]).factory("MessagesFactory",["$resource",function(e){return e("/api/v1/messages/:messageId/:param",{messageId:"@messageId"},{query:{method:"GET",isArray:!1,cache:!1}})}]).factory("FiltersFactory",["$resource",function(e){return e("/api/v1/filter/state/:filterId/:param",{filterId:"@filterId"},{query:{method:"GET",isArray:!1,cache:!1},save:{method:"POST"},update:{method:"PATCH"},"delete":{method:"DELETE"}})}]).factory("PhotosFactory",["$resource",function(e){return e("/api/v1/photo/:photoId/:param",{photoId:"@photoId"},{query:{method:"GET",isArray:!1,cache:!1},save:{method:"POST"},update:{method:"PATCH"},"delete":{method:"DELETE"}})}]),angular.module("beKindred").controller("MainCtrl",["$scope",function(e){e.repeatN=function(e){return new Array(e)},e.showfullprofile=!1,e.switchFullProfile=function(){e.showfullprofile=!e.showfullprofile}}]),angular.module("beKindred").controller("MyPageController",["$scope","PhotosFactory","USER_ID","USER_PHOTO",function(e,o,t,n){e.photosSlider=[],e.getPhotos=function(){o.query({format:"json"}).$promise.then(function(r){if(e.photosSlider=r.objects,0===e.photosSlider.length){var s={photo:n,order:0,user:"/api/v1/auth/user/"+t+"/"};o.save({},s,function(o){console.log(o),console.log("New photo saved."),e.getPhotos()},function(e){console.log(e)})}})},e.getPhotos(),e.$on("ngRepeatFinished",function(){new Swiper(".swiper-container",{pagination:".pagination",loop:!1,grabCursor:!0,paginationClickable:!0})})}]),angular.module("beKindred").controller("PhotosMatchedProfileController",["$scope","PhotosFactory","MATCHED_ID","MATCHED_PHOTO",function(e,o,t,n){e.photosSlider=[{photo:n,order:0}],e.$on("ngRepeatFinished",function(){new Swiper(".swiper-container",{pagination:".pagination",loop:!1,grabCursor:!0,paginationClickable:!0})})}]),angular.module("beKindred").controller("PhotosController",["$scope","PhotosFactory","$filter","USER_ID","USER_PHOTO","$cookies","$http","FB_TOKEN",function(e,o,t,n,r,s,a,i){e.apiPhotos=[],e.photos=[{id:0,order:0,photo:""},{id:0,order:1,photo:""},{id:0,order:2,photo:""},{id:0,order:3,photo:""},{id:0,order:4,photo:""},{id:0,order:5,photo:""}],e.photosSlider=[],e.facebookPhotos=[],e.onDropComplete=function(t,n,r){var s=e.photos[t],a=e.photos.indexOf(n);console.log(r),e.photos[t]=n,e.photos[t].order=t,e.photos[a]=s,e.photos[a].order=a,o.update({photoId:e.photos[t].id},{order:e.photos[t].order},function(){console.log("Photo order saved")},function(e){console.log(e)}),o.update({photoId:e.photos[a].id},{order:e.photos[a].order},function(){console.log("Photo order saved")},function(e){console.log(e)})},e.getPhotos=function(){o.query({format:"json"}).$promise.then(function(o){e.apiPhotos=o.objects;for(var t in e.apiPhotos)for(var n in e.photos)e.photos[n].order===e.apiPhotos[t].order&&(e.photos[n].id=e.apiPhotos[t].id,e.photos[n].photo=e.apiPhotos[t].photo);e.photosSlider=e.apiPhotos})},e.getPhotos(),e.currentAlbum="",e.getFBPhotos=function(o,t){e.currentAlbum=t,a.get("https://graph.facebook.com/"+o+"?fields=photos{id,height,width,source}&access_token="+i).success(function(o){console.log(o),e.hideAlbums=!0,e.facebookPhotos=o.photos.data}).error(function(e){console.log(e)})},e.backToAlbums=function(){e.currentAlbum="",e.hideAlbums=!e.hideAlbums},e.facebookAlbums=[],e.hideAlbums=!1,e.getFBAlbums=function(){a.get("https://graph.facebook.com/me/albums?fields=picture,name&access_token="+i).success(function(o){console.log(o),e.facebookAlbums=o.data}).error(function(e){console.log(e)})},e.getFBAlbums(),e.deletePhoto=function(){var t=e.userPhotoDeleteIndex;o.delete({photoId:e.photos[t].id},function(){e.photos[t].photo="",console.log("Photo deleted")},function(e){console.log(e)})},e.createPhoto=function(t){console.log("Creating photo");var r=e.facebookPhotos[t],s={photo:r.source,order:e.newPhotoIndex,user:"/api/v1/auth/user/"+n+"/"};o.save({},s,function(o){console.log(o),console.log("New photo saved."),e.getPhotos()},function(e){console.log(e)});var a=e.newPhotoIndex;e.photos[a].photo=r.photo,$("#photos_modal").modal("hide")},e.$on("ngRepeatFinished",function(){$("#photos_modal").modal("attach events",".add_photo","show"),$("#deletePhotoModal").modal("attach events",".delete_photo","show"),$(".special.cards .image").dimmer({on:"hover"})})}]),angular.module("beKindred").controller("FilterController",["$scope","FiltersFactory","USER_ID",function(e,o,t){e.distanceValue=50,e.distanceOptions={range:{min:1,max:1e4}},e.genders="",e.defaultFilters={objects:[{distance:50,gender:"m,f",min_age:25,max_age:60,keyword:"",user:"/api/v1/auth/user/"+t+"/"}]},e.showMessage=!1,e.filterID=null,e.ageValues=[25,60],e.ageOptions={range:{min:18,max:115}},e.myKeywords=[],e.saveFilters=function(){o.query({format:"json"}).$promise.then(function(n){e.filters=n.objects,e.filterID=e.filters[0].id,e.newFilters={distance:e.distanceValue,gender:e.genders,min_age:e.ageValues[0],max_age:e.ageValues[1],keyword:e.myKeywords.join(),id:e.filterID,user:"/api/v1/auth/user/"+t+"/"},o.update({filterId:e.filterID},e.newFilters,function(){},function(){})})},e.getFilters=function(){o.query({format:"json"}).$promise.then(function(t){e.filters=t.objects,0===e.filters.length?o.update({},e.defaultFilters,function(){$(".ui.checkbox").checkbox("check")},function(e){console.log(e)}):(e.distanceValue=t.objects[0].distance,e.ageValues[0]=t.objects[0].min_age,e.ageValues[1]=t.objects[0].max_age,""!==t.objects[0].keyword&&(e.myKeywords=t.objects[0].keyword.split(",")),""===t.objects[0].gender&&$(".ui.checkbox").checkbox("uncheck"),"m,f"===t.objects[0].gender&&$(".ui.checkbox").checkbox("check"),"m"===t.objects[0].gender&&($("#male").checkbox("check"),$("#female").checkbox("uncheck")),"f"===t.objects[0].gender&&($("#female").checkbox("check"),$("#male").checkbox("uncheck")))})},e.getFilters(),e.removeKeyword=function(o){e.myKeywords.splice(o,1),e.saveFilters()},e.addKeyword=function(o){var t=_.some(e.myKeywords,function(e){return e===o});t?e.showMessage=!0:(e.myKeywords.push(o),e.saveFilters(),e.newKeyword="",e.showMessage=!1)}}]),angular.module("beKindred").controller("GoalsController",["$scope","GoalsFactory",function(e,o){e.goals=[],e.getGoals=function(t){o.query({query:t}).$promise.then(function(o){e.goals=o.goals})}}]).controller("MessagesController",["$scope","MessagesFactory","$timeout",function(e,o,t){e.messages=[{left:!0,content:"Hey, my name is Sasa! I'd like to help you to learn front end development",time:new Date},{left:!1,content:"Thanks for the offer! Yes, I would like to learn in. When are you available to teach me?",time:new Date}],e.q="",e.getMessages=function(){o.query({q:e.q}).$promise.then(function(o){e.messages=o.messages})},e.submit=function(){angular.element("#myform").submit()},e.sendMessage=function(){angular.element("#sendform").submit()},e.getRandomInt=function(e,o){return Math.floor(Math.random()*(o-e+1))+e},e.sendNewMessage=function(){var o={};o={left:e.getRandomInt(0,1),content:e.newmessage,time:new Date},e.messages.push(o),e.newmessage="",t(function(){var e=angular.element(".conversation-content")[0].scrollHeight;console.log(e),angular.element(".conversation-content").animate({scrollTop:e},1500)},100)}}]);