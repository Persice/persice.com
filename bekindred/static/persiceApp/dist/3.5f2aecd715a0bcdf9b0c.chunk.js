webpackJsonp([3],{864:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),message_single_component_1=__webpack_require__(865),MessageListComponent=function(){function MessageListComponent(){}return __decorate([core_1.Input(),__metadata("design:type",Object)],MessageListComponent.prototype,"messages",void 0),MessageListComponent=__decorate([core_1.Component({selector:"message-list",template:'\n  <template ngFor #item [ngForOf]="messages">\n    <div class="chat__time">\n      <hr class="hr">\n      <span class="chat__time__value">{{item.displayDate}}</span>\n    </div>\n    <message *ngFor="#m of item.data" [message]="m"></message>\n  </template>\n  ',directives:[message_single_component_1.MessageSingleComponent]}),__metadata("design:paramtypes",[])],MessageListComponent)}();exports.MessageListComponent=MessageListComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},865:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),router_1=__webpack_require__(20),MessageSingleComponent=function(){function MessageSingleComponent(_router){this._router=_router}return MessageSingleComponent.prototype.openProfile=function(username){this._router.parent.parent.navigate(["./ProfileView",{username:username}])},__decorate([core_1.Input(),__metadata("design:type",Object)],MessageSingleComponent.prototype,"message",void 0),MessageSingleComponent=__decorate([core_1.Component({selector:"message",template:'\n  <div class="message is-open">\n    <div class="flag flag--top flag--small">\n      <div class="flag__img" (click)="openProfile(message.username)">\n        <div class="avatar avatar--medium">\n          <div class="avatar-holder"\n          [ngStyle]="{\'background-image\': \'url(\' + message.image + \')\'}">\n          </div>\n        </div>\n      </div>\n      <div class="flag__body">\n        <div class="message__name">\n          <span (click)="openProfile(message.username)">{{message?.name}}</span>\n          <span (click)="openProfile(message.username)" class="message__timestamp">{{message?.time}}</span>\n        </div>\n        <div class="message__text">{{message?.body}}</div>\n      </div>\n    </div>\n  </div>\n  ',changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[router_1.Router])],MessageSingleComponent)}();exports.MessageSingleComponent=MessageSingleComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},433:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),router_1=__webpack_require__(20),inbox_service_1=__webpack_require__(199),messages_sidebar_component_1=__webpack_require__(868),messages_chat_component_1=__webpack_require__(866),messages_new_component_1=__webpack_require__(867),messages_sidebar_header_component_1=__webpack_require__(869),view=__webpack_require__(839),MessagesComponent=function(){function MessagesComponent(inboxService,_router){this.inboxService=inboxService,this._router=_router,this.counter=0}return MessagesComponent.prototype.ngOnInit=function(){document.body.scrollTop=document.documentElement.scrollTop=0},MessagesComponent.prototype.navigateToConversation=function(id){this._router.navigate(["SingleConversation",{threadId:id}])},MessagesComponent=__decorate([core_1.Component({selector:"message",template:view,directives:[messages_sidebar_component_1.MessagesSidebarComponent,messages_sidebar_header_component_1.MessagesSidebarHeaderComponent,router_1.ROUTER_DIRECTIVES],providers:[inbox_service_1.InboxService]}),router_1.RouteConfig([{path:"/:threadId",component:messages_chat_component_1.MessagesChatComponent,name:"SingleConversation"},{path:"/new/",component:messages_new_component_1.MessagesNewComponent,name:"ConversationNew",useAsDefault:!0},{path:"/new/:friendId",component:messages_new_component_1.MessagesNewComponent,name:"ConversationNewSelected"}]),__metadata("design:paramtypes",[inbox_service_1.InboxService,router_1.Router])],MessagesComponent)}();exports.MessagesComponent=MessagesComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},839:function(module,exports){module.exports='<div class="layout layout--flush position-relative">\n  <div class="layout__item extralarge-and-up-3/10 4/10">\n    <messages-sidebar-header [counter]="counter"></messages-sidebar-header>\n    <aside class="chat-sidebar is-scrollable-y" id="inbox" (selected)="navigateToConversation($event)">\n    </aside>\n  </div>\n  <div class="layout__item extralarge-and-up-7/10 6/10">\n    <router-outlet></router-outlet>\n  </div>\n</div>\n'},866:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),router_1=__webpack_require__(20),inbox_service_1=__webpack_require__(199),userauth_service_1=__webpack_require__(47),messages_service_1=__webpack_require__(207),messages_counter_service_1=__webpack_require__(89),websocket_service_1=__webpack_require__(127),message_list_component_1=__webpack_require__(864),messages_input_component_1=__webpack_require__(828),loading_component_1=__webpack_require__(26),messages_header_component_1=__webpack_require__(870),MessagesChatComponent=function(){function MessagesChatComponent(_params,inboxService,messagesService,userService,messagesCounterService,websocketService,_router){this._params=_params,this.inboxService=inboxService,this.messagesService=messagesService,this.userService=userService,this.messagesCounterService=messagesCounterService,this.websocketService=websocketService,this._router=_router,this.name="",this.messages=[],this.loadingMessages=!1,this.loadingMessagesFinished=!1,this.isMessagesEmpty=!1,this.messagesNext="",this.hasNew=!1,this.scrollOffset=null,this.threadId=this._params.get("threadId")}return MessagesChatComponent.prototype.ngOnInit=function(){var _this=this,url="/api/v1/auth/user/"+this.threadId+"/",channel=this.userService.findByUri(url).subscribe(function(data){_this.name=data.first_name,channel.unsubscribe()},function(err){return console.log("User could not be loaded")});this.inboxService.select(this.threadId),setTimeout(function(){_this.messagesCounterService.refreshCounter()},500),this.messagesServiceInstance=this.messagesService.serviceObserver().subscribe(function(res){_this.loadingMessages=res.loading,_this.loadingMessagesFinished=res.finished,_this.isMessagesEmpty=res.isEmpty,_this.messagesNext=res.next,_this.hasNew=res.hasNew;var prevCount=_this.messages.length;if(0===res.total&&res.initialLoadingFinished&&_this._router.parent.navigate(["/Messages","ConversationNewSelected",{friendId:_this.threadId}]),0===prevCount&&!_this.loadingMessages){var elem_1=jQuery("#messages")[0];setTimeout(function(){elem_1.scrollTop=elem_1.scrollHeight})}if(_this.hasNew&&!_this.loadingMessages){var elem_2=jQuery("#messages")[0];setTimeout(function(){elem_2.scrollTop=elem_2.scrollHeight}),_this.hasNew=!1}if(_this.messages=res.data,prevCount>0&&!_this.loadingMessages&&null!==_this.scrollOffset){var elem_3=jQuery("#messages")[0];setTimeout(function(){elem_3.scrollTop=elem_3.scrollHeight-_this.scrollOffset,_this.scrollOffset=null})}_this.loadingMessagesFinished===!1?jQuery("#messages").bind("scroll",_this.handleScrollEvent.bind(_this)):jQuery("#messages").unbind("scroll")}),this.messagesService.startLoadingMessages(this.threadId),this.websocketServiceInstance=this.websocketService.on("messages:new").subscribe(function(data){data.sender==="/api/v1/auth/user/"+_this.threadId+"/"&&_this.messagesService.recievedMessage(data)})},MessagesChatComponent.prototype.handleScrollEvent=function(event){var elem=jQuery("#messages")[0];this.messagesNext&&elem.scrollTop<=50&&(this.loadingMessages||this.hasNew||(this.scrollOffset=elem.scrollHeight,this.messagesService.loadMore(this.threadId)))},MessagesChatComponent.prototype.sendMessage=function(message){this.messagesService.send(this.threadId,message)},MessagesChatComponent.prototype.ngOnDestroy=function(){this.messagesServiceInstance&&this.messagesServiceInstance.unsubscribe(),this.websocketServiceInstance&&this.websocketServiceInstance.unsubscribe()},MessagesChatComponent=__decorate([core_1.Component({selector:"messages-chat",directives:[messages_header_component_1.MessagesHeaderComponent,message_list_component_1.MessageListComponent,messages_input_component_1.MessagesInputComponent,loading_component_1.LoadingComponent],providers:[messages_service_1.MessagesService,userauth_service_1.UserAuthService],template:'\n  <messages-header [name]="name"></messages-header>\n  <div class="chat">\n    <div class="chat-wrapper" id="messages">\n      <div class="chat__messages-wrapper">\n        <div class="chat__messages">\n          <loading [status]="loadingMessages"></loading>\n          <message-list [messages]="messages"></message-list>\n        </div>\n      </div>\n    </div>\n    <div class="chat__send-message" [disabled]="0" (newMessage)="sendMessage($event)"></div>\n  </div>\n  '}),__metadata("design:paramtypes",[router_1.RouteParams,inbox_service_1.InboxService,messages_service_1.MessagesService,userauth_service_1.UserAuthService,messages_counter_service_1.MessagesCounterService,websocket_service_1.WebsocketService,router_1.Router])],MessagesChatComponent)}();exports.MessagesChatComponent=MessagesChatComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},828:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),MessagesInputComponent=function(){function MessagesInputComponent(){this.newMessage=new core_1.EventEmitter,this.message=""}return MessagesInputComponent.prototype.sendMessage=function(event){this.message.length>0&&!this.disabled&&(this.newMessage.next(this.message),this.message="")},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],MessagesInputComponent.prototype,"newMessage",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],MessagesInputComponent.prototype,"disabled",void 0),MessagesInputComponent=__decorate([core_1.Component({selector:".chat__send-message",template:'\n  <div class="tableize">\n    <div class="tableize__cell tableize__cell--fill">\n      <div class="tableize__content">\n        <textarea [(ngModel)]="message" class="c-input c-input--large" placeholder="Write a message"></textarea>\n      </div>\n    </div>\n    <div class="tableize__cell">\n      <div class="tableize__content chat__send-message__has-btn">\n        <a (click)="sendMessage($event)" class="btn btn-1 btn-1--full btn-1--filled btn-1--blue ">Send</a>\n      </div>\n    </div>\n  </div>\n  '}),__metadata("design:paramtypes",[])],MessagesInputComponent)}();exports.MessagesInputComponent=MessagesInputComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},867:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),router_1=__webpack_require__(20),messages_input_component_1=__webpack_require__(828),messages_header_new_component_1=__webpack_require__(871),inbox_service_1=__webpack_require__(199),messages_service_1=__webpack_require__(207),userauth_service_1=__webpack_require__(47),MessagesNewComponent=function(){function MessagesNewComponent(inboxService,messagesService,userService,_router,_params){var _this=this;if(this.inboxService=inboxService,this.messagesService=messagesService,this.userService=userService,this._router=_router,this._params=_params,this.tokens=[],this.initialTokens=[],this.message="",this.friendId=this._params.get("friendId"),null!==this.friendId)var uri="/api/v1/auth/user/"+this.friendId+"/",channel_1=this.userService.findOneByUri(uri).subscribe(function(data){_this.initialTokens=[{first_name:data.first_name,image:data.image,friend_id:_this.friendId}],channel_1.unsubscribe()},function(err){return console.log("user could not be found")})}return MessagesNewComponent.prototype.sendMessage=function(message){var _this=this;if(1===this.tokens.length)var channel_2=this.messagesService.sendNew(this.tokens[0].friend_id,message).subscribe(function(data){channel_2.unsubscribe(),_this.inboxService.addSender(_this.tokens[0].friend_id),_this._router.parent.navigate(["/Messages","SingleConversation",{threadId:_this.tokens[0].friend_id}])},function(error){return console.log("Could not create new message.")})},MessagesNewComponent.prototype.routerOnActivate=function(nextInstruction,prevInstruction){this.inboxService.deselectThreads()},MessagesNewComponent=__decorate([core_1.Component({selector:"messages-new",template:__webpack_require__(840),directives:[messages_header_new_component_1.MessagesHeaderNewComponent,messages_input_component_1.MessagesInputComponent],providers:[messages_service_1.MessagesService]}),__metadata("design:paramtypes",[inbox_service_1.InboxService,messages_service_1.MessagesService,userauth_service_1.UserAuthService,router_1.Router,router_1.RouteParams])],MessagesNewComponent)}();exports.MessagesNewComponent=MessagesNewComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},840:function(module,exports){module.exports='<messages-header-new [initialTokens]="initialTokens" (selected)="tokens = $event"></messages-header-new>\n<div class="chat">\n  <div class="chat-wrapper">\n    <div class="chat__messages-wrapper">\n      <div class="chat__messages">\n        <div class="chat__messages__blank-slate">\n          <svg role="img" class="icon chat-empty-state__icon">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/static/persiceApp/src/assets/icons/icons.svg#start_conversation"></use>\n          </svg>\n          <h3 class="chat-empty-state__title">Start conversation</h3>\n          <p class="chat-empty-state__par">Type your message below to start Conversation</p>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="chat__send-message" [disabled]="tokens.length === 0" (newMessage)="sendMessage($event)"></div>\n</div>\n'},868:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),inbox_service_1=__webpack_require__(199),messages_counter_service_1=__webpack_require__(89),websocket_service_1=__webpack_require__(127),thread_list_component_1=__webpack_require__(875),loading_component_1=__webpack_require__(26),MessagesSidebarComponent=function(){function MessagesSidebarComponent(inboxService,messagesCounterService,websocketService,element){this.inboxService=inboxService,this.messagesCounterService=messagesCounterService,this.websocketService=websocketService,this.element=element,this.selected=new core_1.EventEmitter,this.threads=[],this.loadingInbox=!1,this.loadingInboxFinished=!1,this.isInboxEmpty=!1,this.inboxNext="",this.activeThread=null}return MessagesSidebarComponent.prototype.ngOnInit=function(){var _this=this;this.messagesCounterService.refreshCounter(),this.inboxServiceInstance=this.inboxService.serviceObserver().subscribe(function(res){_this.loadingInbox=res.loading,_this.threads=res.data,_this.loadingInboxFinished=res.finished,_this.isInboxEmpty=res.isEmpty,_this.inboxNext=res.next,_this.activeThread=res.selected,_this.loadingInboxFinished===!1?jQuery(_this.element.nativeElement).bind("scroll",_this.handleScrollEvent.bind(_this)):jQuery(_this.element.nativeElement).unbind("scroll")}),this.inboxService.startLoadingInbox(),this.websocketServiceInstance=this.websocketService.on("messages:new").subscribe(function(data){null!==_this.activeThread&&_this.inboxService.markRead(_this.activeThread),setTimeout(function(){_this.inboxService.addSender(data.friend_id),_this.messagesCounterService.refreshCounter()},500)})},MessagesSidebarComponent.prototype.onSelect=function(thread){this.inboxService.select(thread.threadId),this.selected.next(thread.threadId)},MessagesSidebarComponent.prototype.handleScrollEvent=function(event){var scrollOffset=jQuery(this.element.nativeElement).scrollTop(),threshold=jQuery(document).height()-jQuery("#inbox").height()-60;this.inboxNext&&scrollOffset>threshold&&(this.loadingInbox||this.inboxService.loadMore())},MessagesSidebarComponent.prototype.ngOnDestroy=function(){this.inboxServiceInstance&&this.inboxServiceInstance.unsubscribe(),this.websocketServiceInstance&&this.websocketServiceInstance.unsubscribe()},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],MessagesSidebarComponent.prototype,"selected",void 0),MessagesSidebarComponent=__decorate([core_1.Component({selector:".chat-sidebar",directives:[thread_list_component_1.ThreadListComponent,loading_component_1.LoadingComponent],template:'\n  <thread-list (selected)="onSelect($event)" [active]="activeThread" [threads]="threads"></thread-list>\n  <loading [status]="loadingInbox"></loading>\n  '}),__metadata("design:paramtypes",[inbox_service_1.InboxService,messages_counter_service_1.MessagesCounterService,websocket_service_1.WebsocketService,core_1.ElementRef])],MessagesSidebarComponent)}();exports.MessagesSidebarComponent=MessagesSidebarComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},869:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),router_1=__webpack_require__(20),inbox_service_1=__webpack_require__(199),MessagesSidebarHeaderComponent=function(){function MessagesSidebarHeaderComponent(inboxService){var _this=this;this.inboxService=inboxService,this.inboxServiceObserver=this.inboxService.serviceCounterObserver().subscribe(function(data){_this.counter=data})}return MessagesSidebarHeaderComponent.prototype.ngOnDestroy=function(){this.inboxServiceObserver.unsubscribe()},__decorate([core_1.Input(),__metadata("design:type",Object)],MessagesSidebarHeaderComponent.prototype,"counter",void 0),MessagesSidebarHeaderComponent=__decorate([core_1.Component({selector:"messages-sidebar-header",directives:[router_1.ROUTER_DIRECTIVES],template:'\n  <header class="chat-sidebar-header">\n    <div class="layout layout--middle">\n      <div class="layout__item 3/4">\n        <h3 class="chat-sidebar-header__title">Conversation <span class="chat-sidebar-header__title__value">({{counter}})</span></h3>\n      </div>\n      <div class="layout__item 1/4 text-right">\n        <a [routerLink]="[\'/Messages\']" class="btn btn-1 btn-1--blue btn--icon-circle-small js-share mr-">\n          <svg role="img" class="icon icon--tiny">\n            <use xlink:href="/static/persiceApp/src/assets/icons/icons.svg#icon-new-message"></use>\n          </svg>\n        </a>\n      </div>\n    </div>\n  </header>\n  '}),__metadata("design:paramtypes",[inbox_service_1.InboxService])],MessagesSidebarHeaderComponent)}();exports.MessagesSidebarHeaderComponent=MessagesSidebarHeaderComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},870:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),dropdown_directive_1=__webpack_require__(421),MessagesHeaderComponent=function(){function MessagesHeaderComponent(){}return MessagesHeaderComponent.prototype.ngOnInit=function(){},__decorate([core_1.Input(),__metadata("design:type",Object)],MessagesHeaderComponent.prototype,"name",void 0),MessagesHeaderComponent=__decorate([core_1.Component({selector:"messages-header",directives:[dropdown_directive_1.DropdownDirective],template:__webpack_require__(841)}),__metadata("design:paramtypes",[])],MessagesHeaderComponent)}();exports.MessagesHeaderComponent=MessagesHeaderComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},841:function(module,exports){module.exports='<header class="chat-header">\n  <div class="layout layout--middle" *ngIf="name !== \'\'">\n    <div class="layout__item 3/4">\n      <div class="has-input-left-labeled has-input-left-labeled--big">\n        <label class="left-labeled-label is-hidden" for="">To:</label>\n        <div class="left-labeled-input">\n          <input type="text" class="left-labeled-input is-hidden" placeholder="NAME">\n          <span class="left-labeled-value">{{name}}</span>\n        </div>\n      </div>\n    </div>\n    <div class="layout__item 1/4 text-right">\n      <div class="has-dropdown-basic">\n        <a class="btn btn-1 btn-1--red btn--icon-circle-small js-share mr" dropdown="#messagesDropdown">\n          <svg role="img" class="icon icon--tiny">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/static/persiceApp/src/assets/icons/icons.svg#icon-more"></use>\n          </svg>\n        </a>\n        <div class="dropdown-basic dropdown-basic--medium dropdown-basic--arrow-right" id="messagesDropdown">\n          <ul class="list-bare">\n            <li><a>Delete conversation</a></li>\n            <li><a>Report spam</a></li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</header>\n'},871:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),lodash_1=__webpack_require__(23),messages_search_connections_component_1=__webpack_require__(872),TOKEN_LIMIT=1,MessagesHeaderNewComponent=function(){function MessagesHeaderNewComponent(){this.selected=new core_1.EventEmitter,this.tokens=[],this.searchInputVisible=!0,this.activeToken=-1}return MessagesHeaderNewComponent.prototype.ngOnChanges=function(values){values.initialTokens&&values.initialTokens.currentValue[0]&&this.addToken(values.initialTokens.currentValue[0])},MessagesHeaderNewComponent.prototype.addToken=function(token){if(this.tokens.length<TOKEN_LIMIT){var i=lodash_1.findIndex(this.tokens,{friend_id:token.friend_id});-1===i?(this.tokens=this.tokens.concat([token]),this.activeToken=-1,this.selected.emit(this.tokens)):this.activeToken=i,this.tokens.length===TOKEN_LIMIT&&(this.searchInputVisible=!1)}},MessagesHeaderNewComponent.prototype.removeToken=function(index){this.activeToken=-1,this.tokens.splice(index,1),this.selected.emit(this.tokens),this.searchInputVisible=!0},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],MessagesHeaderNewComponent.prototype,"selected",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],MessagesHeaderNewComponent.prototype,"initialTokens",void 0),MessagesHeaderNewComponent=__decorate([core_1.Component({selector:"messages-header-new",directives:[messages_search_connections_component_1.MessagesSearchConnections],template:__webpack_require__(842)}),__metadata("design:paramtypes",[])],MessagesHeaderNewComponent)}();exports.MessagesHeaderNewComponent=MessagesHeaderNewComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},842:function(module,exports){module.exports='<header class="chat-header has-message-drop">\n  <div class="layout layout--middle">\n    <div class="layout__item">\n      <div class="has-input-left-labeled has-input-left-labeled--big">\n        <label class="left-labeled-label" for="">To:&nbsp;</label>\n        <div class="tokenfield" *ngIf="tokens.length > 0">\n          <div class="token" *ngFor="#token of tokens; #i = index;" (click)="activeToken = i" [ngClass]="{\'active\': activeToken === i}">\n            <span class="token-label">{{token.first_name}}</span>\n            <a (click)="removeToken(i)" class="close">×</a>\n          </div>\n        </div>\n        <div class="left-labeled-input" [ngClass]="{\'is-hidden\': !searchInputVisible}">\n          <messages-search-connections (selected)="addToken($event)"></messages-search-connections>\n        </div>\n      </div>\n    </div>\n  </div>\n</header>\n'},872:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),common_1=__webpack_require__(86),http_1=__webpack_require__(83),MessagesSearchConnections=function(){function MessagesSearchConnections(http){this.http=http,this.selected=new core_1.EventEmitter,this.searchTerm=new common_1.Control,this.resultsVisible=!1,this.selectedIndex=-1,this.resultsCount=0,this.resultsCache=[],this.results=this._search(this.searchTerm.valueChanges)}return MessagesSearchConnections.prototype.keyEvent=function(event){switch(event.keyCode){case 13:-1!==this.selectedIndex&&this.select(this.resultsCache[this.selectedIndex]);break;case 40:this.selectedIndex++,this.selectedIndex>this.resultsCount-1&&(this.selectedIndex=this.resultsCount-1),this.selectedIndex>3&&setTimeout(function(){var container=jQuery(".message-drop"),scrollTo=jQuery(".message-drop__results__result.is-active");jQuery(".message-drop").scrollTop(scrollTo.offset().top-container.offset().top+container.scrollTop())});break;case 38:this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=0),-1!==this.selectedIndex&&setTimeout(function(){var container=jQuery(".message-drop"),scrollTo=jQuery(".message-drop__results__result.is-active");jQuery(".message-drop").scrollTop(scrollTo.offset().top-container.offset().top+container.scrollTop())}),event.preventDefault();break;case 27:this.resultsVisible=!1}},MessagesSearchConnections.prototype.ngOnInit=function(){},MessagesSearchConnections.prototype.select=function(result){this.resultsVisible=!1,this.resultsCache=[],this.searchTerm.updateValue(""),this.selected.emit(result)},MessagesSearchConnections.prototype._search=function(terms,debounceDuration){var _this=this;return void 0===debounceDuration&&(debounceDuration=400),terms.debounceTime(debounceDuration).distinctUntilChanged().switchMap(function(term){return _this._rawSearch(term)})},MessagesSearchConnections.prototype._rawSearch=function(term){var _this=this,url="/api/v1/connectionssearch/?format=json&first_name="+term;return this.http.get(url).map(function(request){_this.selectedIndex=-1;var res=request.json();return _this.resultsCache=res.objects,_this.resultsCount=res.meta.total_count,_this.resultsCount>0?_this.resultsVisible=!0:_this.resultsVisible=!1,_this.resultsCache})},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],MessagesSearchConnections.prototype,"selected",void 0),MessagesSearchConnections=__decorate([core_1.Component({selector:"messages-search-connections",template:__webpack_require__(843)}),__metadata("design:paramtypes",[http_1.Http])],MessagesSearchConnections)}();exports.MessagesSearchConnections=MessagesSearchConnections}).call(exports,__webpack_require__(4),__webpack_require__(5))},843:function(module,exports){module.exports='<input (click)="resultsVisible = true" (focus)="resultsVisible = true" (blur)="resultsVisible = false" (keydown)="keyEvent($event)" [ngFormControl]="searchTerm" type="text" class="left-labeled-input__element js-message-to" placeholder="NAME">\n<div class="message-drop" [ngClass]="{\'is-invisible\': !resultsVisible}">\n  <div class="message-drop__results">\n    <a class="message-drop__results__result" *ngFor="#result of results | async; #i = index" (mouseover)="selectedIndex = i" (click)="select(result)" [ngClass]="{\'is-active\': selectedIndex === i}">\n      <div class="flag flag--small">\n        <div class="flag__img">\n          <div class="avatar avatar--medium">\n            <div class="avatar-holder" [ngStyle]="{\'background-image\': \'url(\' + result.image + \')\'}">>\n            </div>\n          </div>\n        </div>\n        <div class="flag__body">\n          <div class="message__name">{{result.first_name}}</div>\n        </div>\n      </div>\n    </a>\n  </div>\n</div>\n'},875:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),thread_single_component_1=__webpack_require__(876),ThreadListComponent=function(){function ThreadListComponent(){this.selected=new core_1.EventEmitter}return __decorate([core_1.Input(),__metadata("design:type",Object)],ThreadListComponent.prototype,"threads",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],ThreadListComponent.prototype,"active",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ThreadListComponent.prototype,"selected",void 0),ThreadListComponent=__decorate([core_1.Component({selector:"thread-list",template:'\n  <thread-single [isActive]="active" (selected)="selected.next($event)" *ngFor="#item of threads" [thread]="item"></thread-single>\n  ',directives:[thread_single_component_1.ThreadSingleComponent]}),__metadata("design:paramtypes",[])],ThreadListComponent)}();exports.ThreadListComponent=ThreadListComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))},876:function(module,exports,__webpack_require__){(function(__decorate,__metadata){"use strict";var core_1=__webpack_require__(2),ThreadSingleComponent=function(){function ThreadSingleComponent(){this.selected=new core_1.EventEmitter}return ThreadSingleComponent.prototype.onSelect=function(thread){this.isActive!==thread.threadId&&this.selected.next(thread)},__decorate([core_1.Input(),__metadata("design:type",Object)],ThreadSingleComponent.prototype,"thread",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],ThreadSingleComponent.prototype,"isActive",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ThreadSingleComponent.prototype,"selected",void 0),ThreadSingleComponent=__decorate([core_1.Component({selector:"thread-single",template:'\n  <div class="message" [ngClass]="{\'is-active\': isActive === thread.threadId, \'is-unread\': thread.unread === true}" (click)="onSelect(thread)">\n    <div class="flag flag--responsive flag--small">\n      <div class="flag__img">\n        <span class="message__inread-indicator"></span>\n        <div class="avatar avatar--medium">\n          <div class="avatar-holder"\n          [ngStyle]="{\'background-image\': \'url(\' + thread.image + \')\'}">\n          </div>\n        </div>\n      </div>\n      <div class="flag__body">\n        <div class="message__name">{{thread.name}}</div>\n        <div class="message__text truncate">{{thread.body}}</div>\n        <div class="message__time">{{thread.sentAt}}</div>\n        <div class="message__total" [ngClass]="{\'is-visible\': thread.unreadCounter > 0}">{{thread.unreadCounter}}</div>\n      </div>\n    </div>\n  </div>\n  '}),__metadata("design:paramtypes",[])],ThreadSingleComponent)}();exports.ThreadSingleComponent=ThreadSingleComponent}).call(exports,__webpack_require__(4),__webpack_require__(5))}});
//# sourceMappingURL=3.5f2aecd715a0bcdf9b0c.bundle.map