<div class="ui fixed borderless menu center" id="edittopmenu">
    <div class="main container">
        <div class="left menu">
            <a class="ui item" ui-sref="myprofile" ng-hide="showModal">Cancel</a>
        </div>
        <div class="header item">Edit Profile</div>
        <div class="right menu">
            <a class="ui item" ng-click="startSavingChanges()" ng-hide="showModal" ng-class="{'loading': savingAllChanges}">Save</a>
        </div>
    </div>
</div>
<div class="segment" id="my-profile-header-edit" ng-hide="showModal || editInterest">
    <div class="ui segment">
        <div id="tiles" ng-cloak>
            <div class="ui image tile" ng-class="{'left floated medium tile-big': $index === 0, 'left floated small tile-small': $index === 1 || $index === 2 || $index === 4 || $index === 5, 'small tile-small': $index === 3 }" ng-repeat="photo in user.photos track by $index" end-repeat-photos ng-drop="true" ng-drop-success="onDropComplete($index, $data,$event)">
                <a href="" ng-click="$parent.userPhotoDelete = photo; $parent.userPhotoDeleteIndex = $index;" class="ui right corner delete_photo label" ng-show="photo.photo !== ''">
                    <i class="close icon"></i>
                </a>
                <div class="tile-content" ng-show="photo.photo === ''">
                    <div class="content">
                        <div class="center">
                            <a href="" ng-click="$parent.newPhotoIndex = $index; getFBAlbums();" class="ui compact icon button add_photo"><i class="circle add icon"></i> Add Photo</a>
                        </div>
                    </div>
                </div>
                <div style="background-image: url('{{photo.photo}}')" ng-if="photo.cropped_photo === ''" ng-drag="true" ng-drag-data="photo" class="img-bounding-box"> </div>
                <div style="background-image: url('{{photo.cropped_photo}}')" ng-if="photo.cropped_photo !== ''" ng-drag="true" ng-drag-data="photo" class="img-bounding-box"> </div>
            </div>
        </div>
    </div>
</div>
<div class="body segment edit" id="my-profile-body" ng-hide="showModal || editInterest">
    <div class="ui attached segment" id="my-profile-title">
        <h3 class="ui left floated header">
                {{ user.firstName }}<span ng-hide="user.firstName === ''">,</span> {{ user.age }}
            </h3>
    </div>
    <div class="ui attached segment" ng-class="{loading: loadingGoals || loadingOffers || loadingUser || loadingLikes || loadingInterests }">
        <h4 class="ui header">Goals</h4>
        <div class="ui large list">
            <div class="item" end-repeat ng-repeat="goal in user.goals track by $index">
                <div class="content">
                    <div class="description">
                        <div class="ui fluid search goals" rel="{{$index}}" ng-class="{'loading': goal.loading }">
                            <div class="ui fluid leftright action input" ng-class="{'error': goal.error}">
                                <div class="ui removebutton icon circular button" ng-click="removeGoal($index)">
                                    <i class="remove icon"></i>
                                </div>
                                <input type="text" class="prompt" ng-model="goal.subject" ng-change="goalNeedSaving($index)">
                            </div>
                            <div class="results"></div>
                        </div>
                        <div class="ui red pointing fluid label visible transition" ng-if="goal.error">{{goal.errorMessage}}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="ui fluid labeled blue button" ng-click="createNewGoal()">
            <i class="plus icon"></i> Create new Goal
        </div>
        <h4 class="ui header">Offers</h4>
        <div class="ui large list">
            <div class="item" end-repeat ng-repeat="offer in user.offers track by $index">
                <div class="content">
                    <div class="description">
                        <div class="ui fluid search offers" rel="{{$index}}" ng-class="{'loading': offer.loading }">
                            <div class="ui fluid leftright action input" ng-class="{'error': offer.error}">
                                <div class="ui removebutton icon circular button" ng-click="removeOffer($index)">
                                    <i class="remove icon"></i>
                                </div>
                                <input type="text" class="prompt" ng-model="offer.subject" ng-change="offerNeedSaving($index)">
                            </div>
                            <div class="results"></div>
                        </div>
                        <div class="ui red pointing fluid label visible transition" ng-if="offer.error">{{offer.errorMessage}}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="ui fluid labeled blue button" ng-click="createNewOffer()">
            <i class="plus icon"></i> Create new Offer
        </div>
        <h4 class="ui header">About</h4>
        <form class="ui form" ng-class="{loading: loadingAbout}">
            <div class="field">
                <label></label>
                <textarea rows="3" ng-model="user.about_me" ng-blur="saveAbout()"></textarea>
            </div>
        </form>
        <h4 class="ui header">Activities &amp; Interests</h4>
        <div class="ui large list">
            <div class="item" end-repeat ng-repeat="interest in user.interests track by $index">
                <div class="content">
                    <div class="description">
                        <div class="ui fluid search interests" rel="{{$index}}" ng-class="{'loading': interest.loading }">
                            <div class="ui fluid leftright action input" ng-class="{'error': interest.error}">
                                <div class="ui removebutton icon circular button" ng-click="removeInterest($index)">
                                    <i class="remove icon"></i>
                                </div>
                                <input type="text" class="prompt" ng-model="interest.interest_subject" ng-change="interestNeedSaving($index)">
                            </div>
                            <div class="results"></div>
                        </div>
                        <div class="ui red pointing fluid label visible transition" ng-if="interest.error">{{interest.errorMessage}}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="ui fluid labeled blue button" ng-click="createNewInterest()">
            <i class="plus icon"></i> Create new Interest
        </div>
        <h4 class="ui header">Likes</h4>
        <div class="ui list likes">
            <div class="item" ng-repeat="like in user.likes | limitTo:5 track by $index">
                <div class="content">
                    <div class="description">{{ like.name }}</div>
                </div>
            </div>
        </div>
    </div>
    <div class="ui attached segment" id="socialaccounts">
        <h4 class="ui header">Social Accounts</h4>
        <br>
        <a ng-click="link('linkedin')" class="ui icon linkedin labeled fluid button notconnected" ng-if="social.linkedin.length === 0">
            <i class="linkedin icon"></i> Connect
        </a>
        <div class="ui fluid buttons socialbuttons" ng-if="social.linkedin.length > 0">
            <a href="{{ social.linkedin }}" target="_new" class="ui social icon twitter labeled button">
                <i class="linkedin icon"></i> {{user.firstName}}
                <i class="check circle icon right"></i>
            </a>
            <a ng-click="unlink('linkedin')" class="ui right icon circular button disconnect">
                <i class="remove icon"></i>
            </a>
        </div>
        <br>
        <br ng-if="social.linkedin.length > 0">
        <a ng-click="link('twitter')" class="ui icon twitter labeled fluid button notconnected" ng-if="social.twitter.length === 0">
            <i class="twitter icon"></i> Connect
        </a>
        <div class="ui fluid buttons socialbuttons" ng-if="social.twitter.length > 0">
            <a href="https://twitter.com/{{ social.twitter }}" target="_new" class="ui social icon twitter labeled button">
                <i class="twitter icon"></i> {{social.twitter}}
                <i class="check circle icon right"></i>
            </a>
            <a ng-click="unlink('twitter')" class="ui right icon circular button disconnect">
                <i class="remove icon"></i>
            </a>
        </div>
        <br ng-if="social.twitter.length > 0">
        <br>
        <a href="{{ user.facebookProfile }}" target="_new" class="ui social icon facebook labeled fluid button" ng-if="user.facebookProfile !== ''">
            <i class="facebook icon"></i> {{user.firstName}}
            <i class="lock icon right"></i>
        </a>
    </div>
</div>
<!-- modals -->
<div class="ui basic modal" id="deletePhotoModal">
    <i class="close icon"></i>
    <div class="header">
        Please Confirm
    </div>
    <div class="content" ng-cloak>
        <img ng-src="{{userPhotoDelete.photo}}" class="ui image small" alt="">
        <div class="description">
            <p>Are you sure you want to delete your photo?</p>
        </div>
    </div>
    <div class="actions">
        <div class="two fluid ui inverted buttons">
            <div class="ui negative basic inverted button">
                <i class="remove icon"></i> No
            </div>
            <div ng-click="deletePhoto()" class="ui positive basic inverted button">
                <i class="checkmark icon"></i> Yes
            </div>
        </div>
    </div>
</div>
<div class="body basic segment edit" id="my-profile-photos" ng-if="showModal" ng-cloak>
    <div class="ui attached segment" ng-class="{loading: albumsLoading}">
        <div class="ui dividing header">
            <span ng-show="currentAlbum != '' && showPhotos">Choose Photo</span>
            <span ng-show="currentAlbum == ''">Choose Facebook Album</span>
            <span ng-show="currentAlbum != '' && !showPhotos">Crop Photo</span>
        </div>
        <div class="ui selection list" ng-hide="hideAlbums">
            <div class="item" ng-click="getFBPhotos(fbAlbum.id, fbAlbum.name)" ng-repeat="fbAlbum in facebookAlbums track by $index">
                <img class="ui tiny image" ng-src="{{fbAlbum.picture.data.url}}">
                <div class="content">
                    <div class="header">{{fbAlbum.name}}</div>
                </div>
            </div>
        </div>
        <div ng-show="hideAlbums" class="ui basic segment" ng-class="{loading: photosLoading}">
            <button class="ui labeled fluid button backButton" ng-click="backToAlbums()"><i class="angle left big icon"></i>Back to Albums</button>
            <h3 ng-show="showPhotos" class="ui header">{{currentAlbum}}</h3>
            <div class="ui selection list" ng-show="showPhotos">
                <div ng-click="showCrop($index)" class="item button ok" ng-repeat="fbPhoto in facebookPhotos track by $index">
                    <img class="ui small image" ng-src="{{fbPhoto.source}}">
                    <div class="content">
                        <div class="header"></div>
                    </div>
                </div>
            </div>
            <div ng-hide="showPhotos">
                <div class="ui vertically divided centered relaxed grid ">
                    <div class="sixteen wide column">
                        <div class="cropArea">
                            <img-crop image="myImage" result-image="myCroppedImage" area-type="square"></img-crop>
                        </div>
                    </div>
                    <div class="center aligned one column row">
                        <div class="sixteen wide column">
                            <div class="ui segment basic center aligned">
                                <button class="ui button" ng-click="closeModal()">
                                    Cancel
                                </button>
                                <button class="ui primary button" ng-click="createPhoto(myCroppedImage)">
                                    Save Photo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
'use strict';

function refreshConnect() {
    console.log('calling refresh connect22');
    var scope = angular.element(document.getElementById("socialaccounts")).scope();
    scope.refreshUser();


}
</script>
