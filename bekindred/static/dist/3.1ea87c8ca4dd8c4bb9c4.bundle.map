{"version":3,"sources":["webpack:///3.1ea87c8ca4dd8c4bb9c4.chunk.js","webpack:///./src/app/components/message_list/message_list.component.ts","webpack:///./src/app/components/message_single/message_single.component.ts","webpack:///./src/app/components/messages/messages.component.ts","webpack:///./src/app/components/messages/messages.html","webpack:///./src/app/components/messages/messages_chat.component.ts","webpack:///./src/app/components/messages/messages_input.component.ts","webpack:///./src/app/components/messages/messages_new.component.ts","webpack:///./src/app/components/messages/messages_new.html","webpack:///./src/app/components/messages/messages_sidebar.component.ts","webpack:///./src/app/components/messages/messages_sidebar_header.component.ts","webpack:///./src/app/components/messages_header/messages_header.component.ts","webpack:///./src/app/components/messages_header/messages_header.html","webpack:///./src/app/components/messages_header_new/messages_header_new.component.ts","webpack:///./src/app/components/messages_header_new/messages_header_new.html","webpack:///./src/app/components/messages_search_connections/messages_search_connections.component.ts","webpack:///./src/app/components/messages_search_connections/messages_search_connections.html","webpack:///./src/app/components/thread_list/thread_list.component.ts","webpack:///./src/app/components/thread_single/thread_single.component.ts"],"names":["webpackJsonp",844,"module","exports","__webpack_require__","__decorate","this","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","core_1","message_single_component_1","MessageListComponent","Input","prototype","Component","selector","template","directives","MessageSingleComponent",845,"router_1","_router","openProfile","username","parent","navigate","changeDetection","ChangeDetectionStrategy","OnPush","Router",430,"inbox_service_1","messages_sidebar_component_1","messages_chat_component_1","messages_new_component_1","messages_sidebar_header_component_1","view","MessagesComponent","inboxService","counter","ngOnInit","document","body","scrollTop","documentElement","navigateToConversation","id","threadId","MessagesSidebarComponent","MessagesSidebarHeaderComponent","ROUTER_DIRECTIVES","providers","InboxService","RouteConfig","path","component","MessagesChatComponent","name","MessagesNewComponent","useAsDefault",867,846,"userauth_service_1","messages_service_1","messages_counter_service_1","websocket_service_1","message_list_component_1","messages_input_component_1","loading_component_1","messages_header_component_1","_params","messagesService","userService","messagesCounterService","websocketService","messages","loadingMessages","loadingMessagesFinished","isMessagesEmpty","messagesNext","hasNew","scrollOffset","get","_this","url","channel","findByUri","subscribe","data","first_name","unsubscribe","err","console","log","select","setTimeout","refreshCounter","messagesServiceInstance","serviceObserver","res","loading","finished","isEmpty","next","prevCount","total","initialLoadingFinished","friendId","elem_1","jQuery","scrollHeight","elem_2","elem_3","bind","handleScrollEvent","unbind","startLoadingMessages","websocketServiceInstance","on","sender","recievedMessage","event","elem","loadMore","sendMessage","message","send","ngOnDestroy","MessagesHeaderComponent","MessagesInputComponent","LoadingComponent","MessagesService","UserAuthService","RouteParams","MessagesCounterService","WebsocketService",825,"newMessage","EventEmitter","disabled","Output",847,"messages_header_new_component_1","tokens","initialTokens","uri","channel_1","findOneByUri","image","friend_id","channel_2","sendNew","addSender","error","routerOnActivate","nextInstruction","prevInstruction","deselectThreads","MessagesHeaderNewComponent",868,848,"thread_list_component_1","element","selected","threads","loadingInbox","loadingInboxFinished","isInboxEmpty","inboxNext","activeThread","inboxServiceInstance","nativeElement","startLoadingInbox","markRead","onSelect","thread","threshold","height","ThreadListComponent","ElementRef",849,"inboxServiceObserver","serviceCounterObserver",850,"dropdown_directive_1","DropdownDirective",869,851,"lodash_1","messages_search_connections_component_1","TOKEN_LIMIT","searchInputVisible","activeToken","ngOnChanges","values","currentValue","addToken","token","findIndex","concat","emit","removeToken","index","splice","MessagesSearchConnections",870,852,"common_1","http_1","http","searchTerm","Control","resultsVisible","selectedIndex","resultsCount","resultsCache","results","_search","valueChanges","keyEvent","keyCode","container","scrollTo","offset","top","preventDefault","result","updateValue","terms","debounceDuration","debounceTime","distinctUntilChanged","switchMap","term","_rawSearch","map","request","json","objects","meta","total_count","Http",871,855,"thread_single_component_1","ThreadSingleComponent",856,"isActive"],"mappings":"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","file":"3.1ea87c8ca4dd8c4bb9c4.chunk.js","sourcesContent":["webpackJsonp([3],{\n\n/***/ 844:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar message_single_component_1 = __webpack_require__(845);\r\n\tvar MessageListComponent = (function () {\r\n\t    function MessageListComponent() {\r\n\t    }\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], MessageListComponent.prototype, \"messages\", void 0);\r\n\t    MessageListComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'message-list',\r\n\t            template: \"\\n  <template ngFor #item [ngForOf]=\\\"messages\\\">\\n    <div class=\\\"chat__time\\\">\\n      <hr class=\\\"hr\\\">\\n      <span class=\\\"chat__time__value\\\">{{item.displayDate}}</span>\\n    </div>\\n    <message *ngFor=\\\"#m of item.data\\\" [message]=\\\"m\\\"></message>\\n  </template>\\n  \",\r\n\t            directives: [\r\n\t                message_single_component_1.MessageSingleComponent\r\n\t            ]\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [])\r\n\t    ], MessageListComponent);\r\n\t    return MessageListComponent;\r\n\t}());\r\n\texports.MessageListComponent = MessageListComponent;\r\n\n\n/***/ },\n\n/***/ 845:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar router_1 = __webpack_require__(18);\r\n\tvar MessageSingleComponent = (function () {\r\n\t    function MessageSingleComponent(_router) {\r\n\t        this._router = _router;\r\n\t    }\r\n\t    MessageSingleComponent.prototype.openProfile = function (username) {\r\n\t        this._router.parent.parent.navigate(['./ProfileView', { username: username }]);\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], MessageSingleComponent.prototype, \"message\", void 0);\r\n\t    MessageSingleComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'message',\r\n\t            template: \"\\n  <div class=\\\"message is-open\\\">\\n    <div class=\\\"flag flag--top flag--small\\\">\\n      <div class=\\\"flag__img\\\" (click)=\\\"openProfile(message.username)\\\">\\n        <div class=\\\"avatar avatar--medium\\\">\\n          <div class=\\\"avatar-holder\\\"\\n          [ngStyle]=\\\"{'background-image': 'url(' + message.image + ')'}\\\">\\n          </div>\\n        </div>\\n      </div>\\n      <div class=\\\"flag__body\\\">\\n        <div class=\\\"message__name\\\">\\n          <span (click)=\\\"openProfile(message.username)\\\">{{message?.name}}</span>\\n          <span (click)=\\\"openProfile(message.username)\\\" class=\\\"message__timestamp\\\">{{message?.time}}</span>\\n        </div>\\n        <div class=\\\"message__text\\\">{{message?.body}}</div>\\n      </div>\\n    </div>\\n  </div>\\n  \",\r\n\t            changeDetection: core_1.ChangeDetectionStrategy.OnPush\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [router_1.Router])\r\n\t    ], MessageSingleComponent);\r\n\t    return MessageSingleComponent;\r\n\t}());\r\n\texports.MessageSingleComponent = MessageSingleComponent;\r\n\n\n/***/ },\n\n/***/ 430:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar router_1 = __webpack_require__(18);\r\n\t/**\r\n\t * Services\r\n\t */\r\n\tvar inbox_service_1 = __webpack_require__(196);\r\n\t/**\r\n\t * Components\r\n\t */\r\n\tvar messages_sidebar_component_1 = __webpack_require__(848);\r\n\tvar messages_chat_component_1 = __webpack_require__(846);\r\n\tvar messages_new_component_1 = __webpack_require__(847);\r\n\tvar messages_sidebar_header_component_1 = __webpack_require__(849);\r\n\tvar view = __webpack_require__(867);\r\n\tvar MessagesComponent = (function () {\r\n\t    function MessagesComponent(inboxService, _router) {\r\n\t        this.inboxService = inboxService;\r\n\t        this._router = _router;\r\n\t        this.counter = 0;\r\n\t    }\r\n\t    MessagesComponent.prototype.ngOnInit = function () {\r\n\t        document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n\t    };\r\n\t    MessagesComponent.prototype.navigateToConversation = function (id) {\r\n\t        this._router.navigate(['SingleConversation', { threadId: id }]);\r\n\t    };\r\n\t    MessagesComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'message',\r\n\t            template: view,\r\n\t            directives: [\r\n\t                messages_sidebar_component_1.MessagesSidebarComponent,\r\n\t                messages_sidebar_header_component_1.MessagesSidebarHeaderComponent,\r\n\t                router_1.ROUTER_DIRECTIVES\r\n\t            ],\r\n\t            providers: [\r\n\t                inbox_service_1.InboxService\r\n\t            ]\r\n\t        }),\r\n\t        router_1.RouteConfig([\r\n\t            {\r\n\t                path: '/:threadId',\r\n\t                component: messages_chat_component_1.MessagesChatComponent,\r\n\t                name: 'SingleConversation'\r\n\t            },\r\n\t            {\r\n\t                path: '/new/',\r\n\t                component: messages_new_component_1.MessagesNewComponent,\r\n\t                name: 'ConversationNew',\r\n\t                useAsDefault: true\r\n\t            },\r\n\t            {\r\n\t                path: '/new/:friendId',\r\n\t                component: messages_new_component_1.MessagesNewComponent,\r\n\t                name: 'ConversationNewSelected',\r\n\t            }\r\n\t        ]), \r\n\t        __metadata('design:paramtypes', [inbox_service_1.InboxService, router_1.Router])\r\n\t    ], MessagesComponent);\r\n\t    return MessagesComponent;\r\n\t}());\r\n\texports.MessagesComponent = MessagesComponent;\r\n\n\n/***/ },\n\n/***/ 867:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<div class=\\\"layout layout--flush position-relative\\\">\\n  <div class=\\\"layout__item extralarge-and-up-3/10 4/10\\\">\\n    <messages-sidebar-header [counter]=\\\"counter\\\"></messages-sidebar-header>\\n    <aside class=\\\"chat-sidebar is-scrollable-y\\\" id=\\\"inbox\\\" (selected)=\\\"navigateToConversation($event)\\\">\\n    </aside>\\n  </div>\\n  <div class=\\\"layout__item extralarge-and-up-7/10 6/10\\\">\\n    <router-outlet></router-outlet>\\n  </div>\\n</div>\\n\"\n\n/***/ },\n\n/***/ 846:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar router_1 = __webpack_require__(18);\r\n\t/**\r\n\t * Services\r\n\t */\r\n\tvar inbox_service_1 = __webpack_require__(196);\r\n\tvar userauth_service_1 = __webpack_require__(44);\r\n\tvar messages_service_1 = __webpack_require__(204);\r\n\tvar messages_counter_service_1 = __webpack_require__(85);\r\n\tvar websocket_service_1 = __webpack_require__(124);\r\n\t/**\r\n\t * Components\r\n\t */\r\n\tvar message_list_component_1 = __webpack_require__(844);\r\n\tvar messages_input_component_1 = __webpack_require__(825);\r\n\tvar loading_component_1 = __webpack_require__(24);\r\n\tvar messages_header_component_1 = __webpack_require__(850);\r\n\tvar MessagesChatComponent = (function () {\r\n\t    function MessagesChatComponent(_params, inboxService, messagesService, userService, messagesCounterService, websocketService, _router) {\r\n\t        this._params = _params;\r\n\t        this.inboxService = inboxService;\r\n\t        this.messagesService = messagesService;\r\n\t        this.userService = userService;\r\n\t        this.messagesCounterService = messagesCounterService;\r\n\t        this.websocketService = websocketService;\r\n\t        this._router = _router;\r\n\t        this.name = '';\r\n\t        this.messages = [];\r\n\t        this.loadingMessages = false;\r\n\t        this.loadingMessagesFinished = false;\r\n\t        this.isMessagesEmpty = false;\r\n\t        this.messagesNext = '';\r\n\t        this.hasNew = false;\r\n\t        this.scrollOffset = null;\r\n\t        this.threadId = this._params.get('threadId');\r\n\t    }\r\n\t    MessagesChatComponent.prototype.ngOnInit = function () {\r\n\t        var _this = this;\r\n\t        var url = \"/api/v1/auth/user/\" + this.threadId + \"/\";\r\n\t        var channel = this.userService.findByUri(url)\r\n\t            .subscribe(function (data) {\r\n\t            _this.name = data.first_name;\r\n\t            channel.unsubscribe();\r\n\t        }, function (err) { return console.log('User could not be loaded'); });\r\n\t        this.inboxService.select(this.threadId);\r\n\t        setTimeout(function () {\r\n\t            _this.messagesCounterService.refreshCounter();\r\n\t        }, 500);\r\n\t        //subscribe to messages service updates\r\n\t        this.messagesServiceInstance = this.messagesService.serviceObserver()\r\n\t            .subscribe(function (res) {\r\n\t            _this.loadingMessages = res.loading;\r\n\t            _this.loadingMessagesFinished = res.finished;\r\n\t            _this.isMessagesEmpty = res.isEmpty;\r\n\t            _this.messagesNext = res.next;\r\n\t            _this.hasNew = res.hasNew;\r\n\t            // this.name = res.name;\r\n\t            var prevCount = _this.messages.length;\r\n\t            if (res.total === 0 && res.initialLoadingFinished) {\r\n\t                _this._router.parent.navigate(['/Messages', 'ConversationNewSelected', { friendId: _this.threadId }]);\r\n\t            }\r\n\t            //when first loading messages, scroll to bottom\r\n\t            // after initial messages have been rendered\r\n\t            if (prevCount === 0 && !_this.loadingMessages) {\r\n\t                var elem_1 = jQuery('#messages')[0];\r\n\t                setTimeout(function () {\r\n\t                    elem_1.scrollTop = elem_1.scrollHeight;\r\n\t                });\r\n\t            }\r\n\t            //if recieved new message scroll to bottom\r\n\t            if (_this.hasNew && !_this.loadingMessages) {\r\n\t                var elem_2 = jQuery('#messages')[0];\r\n\t                setTimeout(function () {\r\n\t                    elem_2.scrollTop = elem_2.scrollHeight;\r\n\t                });\r\n\t                _this.hasNew = false;\r\n\t            }\r\n\t            _this.messages = res.data;\r\n\t            //when loading more messages finishes, scroll to bottom\r\n\t            // after new messages have been rendered\r\n\t            if (prevCount > 0 && !_this.loadingMessages && _this.scrollOffset !== null) {\r\n\t                var elem_3 = jQuery('#messages')[0];\r\n\t                setTimeout(function () {\r\n\t                    elem_3.scrollTop = elem_3.scrollHeight - _this.scrollOffset;\r\n\t                    _this.scrollOffset = null;\r\n\t                });\r\n\t            }\r\n\t            if (_this.loadingMessagesFinished === false) {\r\n\t                jQuery('#messages').bind('scroll', _this.handleScrollEvent.bind(_this));\r\n\t            }\r\n\t            else {\r\n\t                jQuery('#messages').unbind('scroll');\r\n\t            }\r\n\t        });\r\n\t        //start loading messages\r\n\t        this.messagesService.startLoadingMessages(this.threadId);\r\n\t        //subscribe to webscoket service updates\r\n\t        this.websocketServiceInstance = this.websocketService.on('messages:new').subscribe(function (data) {\r\n\t            if (data.sender === \"/api/v1/auth/user/\" + _this.threadId + \"/\") {\r\n\t                _this.messagesService.recievedMessage(data);\r\n\t            }\r\n\t        });\r\n\t    };\r\n\t    MessagesChatComponent.prototype.handleScrollEvent = function (event) {\r\n\t        //reverse scroll\r\n\t        var elem = jQuery('#messages')[0];\r\n\t        if (this.messagesNext && elem.scrollTop <= 50) {\r\n\t            if (!this.loadingMessages && !this.hasNew) {\r\n\t                this.scrollOffset = elem.scrollHeight;\r\n\t                this.messagesService.loadMore(this.threadId);\r\n\t            }\r\n\t        }\r\n\t    };\r\n\t    MessagesChatComponent.prototype.sendMessage = function (message) {\r\n\t        this.messagesService.send(this.threadId, message);\r\n\t    };\r\n\t    MessagesChatComponent.prototype.ngOnDestroy = function () {\r\n\t        if (this.messagesServiceInstance) {\r\n\t            this.messagesServiceInstance.unsubscribe();\r\n\t        }\r\n\t        if (this.websocketServiceInstance) {\r\n\t            this.websocketServiceInstance.unsubscribe();\r\n\t        }\r\n\t    };\r\n\t    MessagesChatComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'messages-chat',\r\n\t            directives: [\r\n\t                messages_header_component_1.MessagesHeaderComponent,\r\n\t                message_list_component_1.MessageListComponent,\r\n\t                messages_input_component_1.MessagesInputComponent,\r\n\t                loading_component_1.LoadingComponent\r\n\t            ],\r\n\t            providers: [\r\n\t                messages_service_1.MessagesService,\r\n\t                userauth_service_1.UserAuthService\r\n\t            ],\r\n\t            template: \"\\n  <messages-header [name]=\\\"name\\\"></messages-header>\\n  <div class=\\\"chat\\\">\\n    <div class=\\\"chat-wrapper\\\" id=\\\"messages\\\">\\n      <div class=\\\"chat__messages-wrapper\\\">\\n        <div class=\\\"chat__messages\\\">\\n          <loading [status]=\\\"loadingMessages\\\"></loading>\\n          <message-list [messages]=\\\"messages\\\"></message-list>\\n        </div>\\n      </div>\\n    </div>\\n    <div class=\\\"chat__send-message\\\" [disabled]=\\\"0\\\" (newMessage)=\\\"sendMessage($event)\\\"></div>\\n  </div>\\n  \"\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [router_1.RouteParams, inbox_service_1.InboxService, messages_service_1.MessagesService, userauth_service_1.UserAuthService, messages_counter_service_1.MessagesCounterService, websocket_service_1.WebsocketService, router_1.Router])\r\n\t    ], MessagesChatComponent);\r\n\t    return MessagesChatComponent;\r\n\t}());\r\n\texports.MessagesChatComponent = MessagesChatComponent;\r\n\n\n/***/ },\n\n/***/ 825:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar MessagesInputComponent = (function () {\r\n\t    function MessagesInputComponent() {\r\n\t        this.newMessage = new core_1.EventEmitter();\r\n\t        this.message = '';\r\n\t    }\r\n\t    MessagesInputComponent.prototype.sendMessage = function (event) {\r\n\t        if (this.message.length > 0 && !this.disabled) {\r\n\t            this.newMessage.next(this.message);\r\n\t            this.message = '';\r\n\t        }\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Output(), \r\n\t        __metadata('design:type', core_1.EventEmitter)\r\n\t    ], MessagesInputComponent.prototype, \"newMessage\", void 0);\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], MessagesInputComponent.prototype, \"disabled\", void 0);\r\n\t    MessagesInputComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: '.chat__send-message',\r\n\t            template: \"\\n  <div class=\\\"tableize\\\">\\n    <div class=\\\"tableize__cell tableize__cell--fill\\\">\\n      <div class=\\\"tableize__content\\\">\\n        <textarea [(ngModel)]=\\\"message\\\" class=\\\"c-input c-input--large\\\" placeholder=\\\"Write a message\\\"></textarea>\\n      </div>\\n    </div>\\n    <div class=\\\"tableize__cell\\\">\\n      <div class=\\\"tableize__content chat__send-message__has-btn\\\">\\n        <a (click)=\\\"sendMessage($event)\\\" class=\\\"btn btn-1 btn-1--full btn-1--filled btn-1--blue \\\">Send</a>\\n      </div>\\n    </div>\\n  </div>\\n  \"\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [])\r\n\t    ], MessagesInputComponent);\r\n\t    return MessagesInputComponent;\r\n\t}());\r\n\texports.MessagesInputComponent = MessagesInputComponent;\r\n\n\n/***/ },\n\n/***/ 847:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar router_1 = __webpack_require__(18);\r\n\t/**\r\n\t * Components\r\n\t */\r\n\tvar messages_input_component_1 = __webpack_require__(825);\r\n\tvar messages_header_new_component_1 = __webpack_require__(851);\r\n\t/**\r\n\t * Services\r\n\t */\r\n\tvar inbox_service_1 = __webpack_require__(196);\r\n\tvar messages_service_1 = __webpack_require__(204);\r\n\tvar userauth_service_1 = __webpack_require__(44);\r\n\tvar MessagesNewComponent = (function () {\r\n\t    function MessagesNewComponent(inboxService, messagesService, userService, _router, _params) {\r\n\t        var _this = this;\r\n\t        this.inboxService = inboxService;\r\n\t        this.messagesService = messagesService;\r\n\t        this.userService = userService;\r\n\t        this._router = _router;\r\n\t        this._params = _params;\r\n\t        this.tokens = [];\r\n\t        this.initialTokens = [];\r\n\t        this.message = '';\r\n\t        this.friendId = this._params.get('friendId');\r\n\t        //preselect a connection\r\n\t        if (this.friendId !== null) {\r\n\t            var uri = \"/api/v1/auth/user/\" + this.friendId + \"/\";\r\n\t            var channel_1 = this.userService.findOneByUri(uri)\r\n\t                .subscribe(function (data) {\r\n\t                _this.initialTokens = [{\r\n\t                        first_name: data.first_name,\r\n\t                        image: data.image,\r\n\t                        friend_id: _this.friendId\r\n\t                    }];\r\n\t                channel_1.unsubscribe();\r\n\t            }, function (err) { return console.log('user could not be found'); });\r\n\t        }\r\n\t    }\r\n\t    MessagesNewComponent.prototype.sendMessage = function (message) {\r\n\t        var _this = this;\r\n\t        if (this.tokens.length === 1) {\r\n\t            var channel_2 = this.messagesService.sendNew(this.tokens[0].friend_id, message)\r\n\t                .subscribe(function (data) {\r\n\t                channel_2.unsubscribe();\r\n\t                _this.inboxService.addSender(_this.tokens[0].friend_id);\r\n\t                _this._router.parent.navigate(['/Messages', 'SingleConversation', { threadId: _this.tokens[0].friend_id }]);\r\n\t            }, function (error) { return console.log('Could not create new message.'); });\r\n\t        }\r\n\t    };\r\n\t    MessagesNewComponent.prototype.routerOnActivate = function (nextInstruction, prevInstruction) {\r\n\t        this.inboxService.deselectThreads();\r\n\t    };\r\n\t    MessagesNewComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'messages-new',\r\n\t            template: __webpack_require__(868),\r\n\t            directives: [\r\n\t                messages_header_new_component_1.MessagesHeaderNewComponent,\r\n\t                messages_input_component_1.MessagesInputComponent\r\n\t            ],\r\n\t            providers: [\r\n\t                messages_service_1.MessagesService\r\n\t            ]\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [inbox_service_1.InboxService, messages_service_1.MessagesService, userauth_service_1.UserAuthService, router_1.Router, router_1.RouteParams])\r\n\t    ], MessagesNewComponent);\r\n\t    return MessagesNewComponent;\r\n\t}());\r\n\texports.MessagesNewComponent = MessagesNewComponent;\r\n\n\n/***/ },\n\n/***/ 868:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<messages-header-new [initialTokens]=\\\"initialTokens\\\" (selected)=\\\"tokens = $event\\\"></messages-header-new>\\n<div class=\\\"chat\\\">\\n  <div class=\\\"chat-wrapper\\\">\\n    <div class=\\\"chat__messages-wrapper\\\">\\n      <div class=\\\"chat__messages\\\">\\n        <div class=\\\"chat__messages__blank-slate\\\">\\n          <svg role=\\\"img\\\" class=\\\"icon chat-empty-state__icon\\\">\\n            <use xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xlink:href=\\\"/static/assets/icons/icons.svg#start_conversation\\\"></use>\\n          </svg>\\n          <h3 class=\\\"chat-empty-state__title\\\">Start conversation</h3>\\n          <p class=\\\"chat-empty-state__par\\\">Type your message below to start Conversation</p>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n  <div class=\\\"chat__send-message\\\" [disabled]=\\\"tokens.length === 0\\\" (newMessage)=\\\"sendMessage($event)\\\"></div>\\n</div>\\n\"\n\n/***/ },\n\n/***/ 848:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\t/**\r\n\t * Services\r\n\t */\r\n\tvar inbox_service_1 = __webpack_require__(196);\r\n\tvar messages_counter_service_1 = __webpack_require__(85);\r\n\tvar websocket_service_1 = __webpack_require__(124);\r\n\t/**\r\n\t * Components\r\n\t */\r\n\tvar thread_list_component_1 = __webpack_require__(855);\r\n\tvar loading_component_1 = __webpack_require__(24);\r\n\tvar MessagesSidebarComponent = (function () {\r\n\t    function MessagesSidebarComponent(inboxService, messagesCounterService, websocketService, element) {\r\n\t        this.inboxService = inboxService;\r\n\t        this.messagesCounterService = messagesCounterService;\r\n\t        this.websocketService = websocketService;\r\n\t        this.element = element;\r\n\t        this.selected = new core_1.EventEmitter();\r\n\t        this.threads = [];\r\n\t        this.loadingInbox = false;\r\n\t        this.loadingInboxFinished = false;\r\n\t        this.isInboxEmpty = false;\r\n\t        this.inboxNext = '';\r\n\t        this.activeThread = null;\r\n\t    }\r\n\t    MessagesSidebarComponent.prototype.ngOnInit = function () {\r\n\t        var _this = this;\r\n\t        this.messagesCounterService.refreshCounter();\r\n\t        //subscribe to inbox service updates\r\n\t        this.inboxServiceInstance = this.inboxService.serviceObserver()\r\n\t            .subscribe(function (res) {\r\n\t            _this.loadingInbox = res.loading;\r\n\t            _this.threads = res.data;\r\n\t            _this.loadingInboxFinished = res.finished;\r\n\t            _this.isInboxEmpty = res.isEmpty;\r\n\t            _this.inboxNext = res.next;\r\n\t            _this.activeThread = res.selected;\r\n\t            if (_this.loadingInboxFinished === false) {\r\n\t                jQuery(_this.element.nativeElement).bind('scroll', _this.handleScrollEvent.bind(_this));\r\n\t            }\r\n\t            else {\r\n\t                jQuery(_this.element.nativeElement).unbind('scroll');\r\n\t            }\r\n\t        });\r\n\t        //start loading inbox\r\n\t        this.inboxService.startLoadingInbox();\r\n\t        this.websocketServiceInstance = this.websocketService.on('messages:new').subscribe(function (data) {\r\n\t            if (_this.activeThread !== null) {\r\n\t                _this.inboxService.markRead(_this.activeThread);\r\n\t            }\r\n\t            setTimeout(function () {\r\n\t                _this.inboxService.addSender(data.friend_id);\r\n\t                _this.messagesCounterService.refreshCounter();\r\n\t            }, 500);\r\n\t        });\r\n\t    };\r\n\t    MessagesSidebarComponent.prototype.onSelect = function (thread) {\r\n\t        this.inboxService.select(thread.threadId);\r\n\t        this.selected.next(thread.threadId);\r\n\t    };\r\n\t    MessagesSidebarComponent.prototype.handleScrollEvent = function (event) {\r\n\t        var scrollOffset = jQuery(this.element.nativeElement).scrollTop();\r\n\t        var threshold = jQuery(document).height() - jQuery('#inbox').height() - 60;\r\n\t        if (this.inboxNext && scrollOffset > threshold) {\r\n\t            if (!this.loadingInbox) {\r\n\t                this.inboxService.loadMore();\r\n\t            }\r\n\t        }\r\n\t    };\r\n\t    MessagesSidebarComponent.prototype.ngOnDestroy = function () {\r\n\t        if (this.inboxServiceInstance) {\r\n\t            this.inboxServiceInstance.unsubscribe();\r\n\t        }\r\n\t        if (this.websocketServiceInstance) {\r\n\t            this.websocketServiceInstance.unsubscribe();\r\n\t        }\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Output(), \r\n\t        __metadata('design:type', core_1.EventEmitter)\r\n\t    ], MessagesSidebarComponent.prototype, \"selected\", void 0);\r\n\t    MessagesSidebarComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: '.chat-sidebar',\r\n\t            directives: [\r\n\t                thread_list_component_1.ThreadListComponent,\r\n\t                loading_component_1.LoadingComponent\r\n\t            ],\r\n\t            template: \"\\n  <thread-list (selected)=\\\"onSelect($event)\\\" [active]=\\\"activeThread\\\" [threads]=\\\"threads\\\"></thread-list>\\n  <loading [status]=\\\"loadingInbox\\\"></loading>\\n  \"\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [inbox_service_1.InboxService, messages_counter_service_1.MessagesCounterService, websocket_service_1.WebsocketService, core_1.ElementRef])\r\n\t    ], MessagesSidebarComponent);\r\n\t    return MessagesSidebarComponent;\r\n\t}());\r\n\texports.MessagesSidebarComponent = MessagesSidebarComponent;\r\n\n\n/***/ },\n\n/***/ 849:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar router_1 = __webpack_require__(18);\r\n\tvar inbox_service_1 = __webpack_require__(196);\r\n\tvar MessagesSidebarHeaderComponent = (function () {\r\n\t    function MessagesSidebarHeaderComponent(inboxService) {\r\n\t        var _this = this;\r\n\t        this.inboxService = inboxService;\r\n\t        this.inboxServiceObserver = this.inboxService.serviceCounterObserver()\r\n\t            .subscribe(function (data) {\r\n\t            _this.counter = data;\r\n\t        });\r\n\t    }\r\n\t    MessagesSidebarHeaderComponent.prototype.ngOnDestroy = function () {\r\n\t        this.inboxServiceObserver.unsubscribe();\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], MessagesSidebarHeaderComponent.prototype, \"counter\", void 0);\r\n\t    MessagesSidebarHeaderComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'messages-sidebar-header',\r\n\t            directives: [\r\n\t                router_1.ROUTER_DIRECTIVES\r\n\t            ],\r\n\t            template: \"\\n  <header class=\\\"chat-sidebar-header\\\">\\n    <div class=\\\"layout layout--middle\\\">\\n      <div class=\\\"layout__item 3/4\\\">\\n        <h3 class=\\\"chat-sidebar-header__title\\\">Conversation <span class=\\\"chat-sidebar-header__title__value\\\">({{counter}})</span></h3>\\n      </div>\\n      <div class=\\\"layout__item 1/4 text-right\\\">\\n        <a [routerLink]=\\\"['/Messages']\\\" class=\\\"btn btn-1 btn-1--blue btn--icon-circle-small js-share mr-\\\">\\n          <svg role=\\\"img\\\" class=\\\"icon icon--tiny\\\">\\n            <use xlink:href=\\\"/static/assets/icons/icons.svg#icon-new-message\\\"></use>\\n          </svg>\\n        </a>\\n      </div>\\n    </div>\\n  </header>\\n  \"\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [inbox_service_1.InboxService])\r\n\t    ], MessagesSidebarHeaderComponent);\r\n\t    return MessagesSidebarHeaderComponent;\r\n\t}());\r\n\texports.MessagesSidebarHeaderComponent = MessagesSidebarHeaderComponent;\r\n\n\n/***/ },\n\n/***/ 850:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar dropdown_directive_1 = __webpack_require__(418);\r\n\tvar MessagesHeaderComponent = (function () {\r\n\t    function MessagesHeaderComponent() {\r\n\t    }\r\n\t    MessagesHeaderComponent.prototype.ngOnInit = function () {\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], MessagesHeaderComponent.prototype, \"name\", void 0);\r\n\t    MessagesHeaderComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'messages-header',\r\n\t            directives: [\r\n\t                dropdown_directive_1.DropdownDirective\r\n\t            ],\r\n\t            template: __webpack_require__(869)\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [])\r\n\t    ], MessagesHeaderComponent);\r\n\t    return MessagesHeaderComponent;\r\n\t}());\r\n\texports.MessagesHeaderComponent = MessagesHeaderComponent;\r\n\n\n/***/ },\n\n/***/ 869:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<header class=\\\"chat-header\\\">\\n  <div class=\\\"layout layout--middle\\\" *ngIf=\\\"name !== ''\\\">\\n    <div class=\\\"layout__item 3/4\\\">\\n      <div class=\\\"has-input-left-labeled has-input-left-labeled--big\\\">\\n        <label class=\\\"left-labeled-label is-hidden\\\" for=\\\"\\\">To:</label>\\n        <div class=\\\"left-labeled-input\\\">\\n          <input type=\\\"text\\\" class=\\\"left-labeled-input is-hidden\\\" placeholder=\\\"NAME\\\">\\n          <span class=\\\"left-labeled-value\\\">{{name}}</span>\\n        </div>\\n      </div>\\n    </div>\\n    <div class=\\\"layout__item 1/4 text-right\\\">\\n      <div class=\\\"has-dropdown-basic\\\">\\n        <a class=\\\"btn btn-1 btn-1--red btn--icon-circle-small js-share mr\\\" dropdown=\\\"#messagesDropdown\\\">\\n          <svg role=\\\"img\\\" class=\\\"icon icon--tiny\\\">\\n            <use xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xlink:href=\\\"/static/assets/icons/icons.svg#icon-more\\\"></use>\\n          </svg>\\n        </a>\\n        <div class=\\\"dropdown-basic dropdown-basic--medium dropdown-basic--arrow-right\\\" id=\\\"messagesDropdown\\\">\\n          <ul class=\\\"list-bare\\\">\\n            <li><a>Delete conversation</a></li>\\n            <li><a>Report spam</a></li>\\n          </ul>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</header>\\n\"\n\n/***/ },\n\n/***/ 851:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar lodash_1 = __webpack_require__(21);\r\n\t/**\r\n\t * Components\r\n\t */\r\n\tvar messages_search_connections_component_1 = __webpack_require__(852);\r\n\tvar TOKEN_LIMIT = 1;\r\n\tvar MessagesHeaderNewComponent = (function () {\r\n\t    function MessagesHeaderNewComponent() {\r\n\t        this.selected = new core_1.EventEmitter;\r\n\t        this.tokens = [];\r\n\t        this.searchInputVisible = true;\r\n\t        this.activeToken = -1;\r\n\t    }\r\n\t    MessagesHeaderNewComponent.prototype.ngOnChanges = function (values) {\r\n\t        if (values.initialTokens && values.initialTokens.currentValue[0]) {\r\n\t            //add initial token;\r\n\t            this.addToken(values.initialTokens.currentValue[0]);\r\n\t        }\r\n\t    };\r\n\t    MessagesHeaderNewComponent.prototype.addToken = function (token) {\r\n\t        //check if limit is reached\r\n\t        if (this.tokens.length < TOKEN_LIMIT) {\r\n\t            //check if token already exists\r\n\t            var i = lodash_1.findIndex(this.tokens, { friend_id: token.friend_id });\r\n\t            if (i === -1) {\r\n\t                this.tokens = this.tokens.concat([token]);\r\n\t                this.activeToken = -1;\r\n\t                this.selected.emit(this.tokens);\r\n\t            }\r\n\t            else {\r\n\t                this.activeToken = i;\r\n\t            }\r\n\t            //if token limit reached, hide search input\r\n\t            if (this.tokens.length === TOKEN_LIMIT) {\r\n\t                this.searchInputVisible = false;\r\n\t            }\r\n\t        }\r\n\t    };\r\n\t    MessagesHeaderNewComponent.prototype.removeToken = function (index) {\r\n\t        this.activeToken = -1;\r\n\t        this.tokens.splice(index, 1);\r\n\t        this.selected.emit(this.tokens);\r\n\t        this.searchInputVisible = true;\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Output(), \r\n\t        __metadata('design:type', core_1.EventEmitter)\r\n\t    ], MessagesHeaderNewComponent.prototype, \"selected\", void 0);\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], MessagesHeaderNewComponent.prototype, \"initialTokens\", void 0);\r\n\t    MessagesHeaderNewComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'messages-header-new',\r\n\t            directives: [\r\n\t                messages_search_connections_component_1.MessagesSearchConnections\r\n\t            ],\r\n\t            template: __webpack_require__(870)\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [])\r\n\t    ], MessagesHeaderNewComponent);\r\n\t    return MessagesHeaderNewComponent;\r\n\t}());\r\n\texports.MessagesHeaderNewComponent = MessagesHeaderNewComponent;\r\n\n\n/***/ },\n\n/***/ 870:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<header class=\\\"chat-header has-message-drop\\\">\\n  <div class=\\\"layout layout--middle\\\">\\n    <div class=\\\"layout__item\\\">\\n      <div class=\\\"has-input-left-labeled has-input-left-labeled--big\\\">\\n        <label class=\\\"left-labeled-label\\\" for=\\\"\\\">To:&nbsp;</label>\\n        <div class=\\\"tokenfield\\\" *ngIf=\\\"tokens.length > 0\\\">\\n          <div class=\\\"token\\\" *ngFor=\\\"#token of tokens; #i = index;\\\" (click)=\\\"activeToken = i\\\" [ngClass]=\\\"{'active': activeToken === i}\\\">\\n            <span class=\\\"token-label\\\">{{token.first_name}}</span>\\n            <a (click)=\\\"removeToken(i)\\\" class=\\\"close\\\"></a>\\n          </div>\\n        </div>\\n        <div class=\\\"left-labeled-input\\\" [ngClass]=\\\"{'is-hidden': !searchInputVisible}\\\">\\n          <messages-search-connections (selected)=\\\"addToken($event)\\\"></messages-search-connections>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</header>\\n\"\n\n/***/ },\n\n/***/ 852:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar common_1 = __webpack_require__(86);\r\n\tvar http_1 = __webpack_require__(80);\r\n\tvar MessagesSearchConnections = (function () {\r\n\t    function MessagesSearchConnections(http) {\r\n\t        this.http = http;\r\n\t        this.selected = new core_1.EventEmitter();\r\n\t        this.searchTerm = new common_1.Control();\r\n\t        this.resultsVisible = false;\r\n\t        this.selectedIndex = -1;\r\n\t        this.resultsCount = 0;\r\n\t        this.resultsCache = [];\r\n\t        this.results = this._search(this.searchTerm.valueChanges);\r\n\t    }\r\n\t    MessagesSearchConnections.prototype.keyEvent = function (event) {\r\n\t        switch (event.keyCode) {\r\n\t            case 13:\r\n\t                //enter\r\n\t                if (this.selectedIndex !== -1) {\r\n\t                    this.select(this.resultsCache[this.selectedIndex]);\r\n\t                }\r\n\t                break;\r\n\t            case 40:\r\n\t                //down\r\n\t                this.selectedIndex++;\r\n\t                if (this.selectedIndex > this.resultsCount - 1) {\r\n\t                    this.selectedIndex = this.resultsCount - 1;\r\n\t                }\r\n\t                if (this.selectedIndex > 3) {\r\n\t                    setTimeout(function () {\r\n\t                        var container = jQuery('.message-drop');\r\n\t                        var scrollTo = jQuery('.message-drop__results__result.is-active');\r\n\t                        jQuery('.message-drop').scrollTop(scrollTo.offset().top - container.offset().top + container.scrollTop());\r\n\t                    });\r\n\t                }\r\n\t                break;\r\n\t            case 38:\r\n\t                //up\r\n\t                this.selectedIndex--;\r\n\t                if (this.selectedIndex < 0) {\r\n\t                    this.selectedIndex = 0;\r\n\t                }\r\n\t                if (this.selectedIndex !== -1) {\r\n\t                    setTimeout(function () {\r\n\t                        var container = jQuery('.message-drop');\r\n\t                        var scrollTo = jQuery('.message-drop__results__result.is-active');\r\n\t                        jQuery('.message-drop').scrollTop(scrollTo.offset().top - container.offset().top + container.scrollTop());\r\n\t                    });\r\n\t                }\r\n\t                //prevent moving cursor to begining of input\r\n\t                event.preventDefault();\r\n\t                break;\r\n\t            case 27:\r\n\t                //escape\r\n\t                this.resultsVisible = false;\r\n\t                break;\r\n\t            default:\r\n\t                break;\r\n\t        }\r\n\t    };\r\n\t    MessagesSearchConnections.prototype.ngOnInit = function () {\r\n\t    };\r\n\t    MessagesSearchConnections.prototype.select = function (result) {\r\n\t        this.resultsVisible = false;\r\n\t        this.resultsCache = [];\r\n\t        this.searchTerm.updateValue('');\r\n\t        this.selected.emit(result);\r\n\t    };\r\n\t    MessagesSearchConnections.prototype._search = function (terms, debounceDuration) {\r\n\t        var _this = this;\r\n\t        if (debounceDuration === void 0) { debounceDuration = 400; }\r\n\t        return terms.debounceTime(debounceDuration)\r\n\t            .distinctUntilChanged()\r\n\t            .switchMap(function (term) { return _this._rawSearch(term); });\r\n\t    };\r\n\t    MessagesSearchConnections.prototype._rawSearch = function (term) {\r\n\t        var _this = this;\r\n\t        var url = \"/api/v1/connectionssearch/?format=json&first_name=\" + term;\r\n\t        return this.http\r\n\t            .get(url)\r\n\t            .map(function (request) {\r\n\t            _this.selectedIndex = -1;\r\n\t            var res = request.json();\r\n\t            _this.resultsCache = res.objects;\r\n\t            _this.resultsCount = res.meta.total_count;\r\n\t            if (_this.resultsCount > 0) {\r\n\t                _this.resultsVisible = true;\r\n\t            }\r\n\t            else {\r\n\t                _this.resultsVisible = false;\r\n\t            }\r\n\t            return _this.resultsCache;\r\n\t        });\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Output(), \r\n\t        __metadata('design:type', core_1.EventEmitter)\r\n\t    ], MessagesSearchConnections.prototype, \"selected\", void 0);\r\n\t    MessagesSearchConnections = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'messages-search-connections',\r\n\t            template: __webpack_require__(871)\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [http_1.Http])\r\n\t    ], MessagesSearchConnections);\r\n\t    return MessagesSearchConnections;\r\n\t}());\r\n\texports.MessagesSearchConnections = MessagesSearchConnections;\r\n\n\n/***/ },\n\n/***/ 871:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<input (click)=\\\"resultsVisible = true\\\" (focus)=\\\"resultsVisible = true\\\" (blur)=\\\"resultsVisible = false\\\" (keydown)=\\\"keyEvent($event)\\\" [ngFormControl]=\\\"searchTerm\\\" type=\\\"text\\\" class=\\\"left-labeled-input__element js-message-to\\\" placeholder=\\\"NAME\\\">\\n<div class=\\\"message-drop\\\" [ngClass]=\\\"{'is-invisible': !resultsVisible}\\\">\\n  <div class=\\\"message-drop__results\\\">\\n    <a class=\\\"message-drop__results__result\\\" *ngFor=\\\"#result of results | async; #i = index\\\" (mouseover)=\\\"selectedIndex = i\\\" (click)=\\\"select(result)\\\" [ngClass]=\\\"{'is-active': selectedIndex === i}\\\">\\n      <div class=\\\"flag flag--small\\\">\\n        <div class=\\\"flag__img\\\">\\n          <div class=\\\"avatar avatar--medium\\\">\\n            <div class=\\\"avatar-holder\\\" [ngStyle]=\\\"{'background-image': 'url(' + result.image + ')'}\\\">>\\n            </div>\\n          </div>\\n        </div>\\n        <div class=\\\"flag__body\\\">\\n          <div class=\\\"message__name\\\">{{result.first_name}}</div>\\n        </div>\\n      </div>\\n    </a>\\n  </div>\\n</div>\\n\"\n\n/***/ },\n\n/***/ 855:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\t/**\r\n\t * Components\r\n\t */\r\n\tvar thread_single_component_1 = __webpack_require__(856);\r\n\tvar ThreadListComponent = (function () {\r\n\t    function ThreadListComponent() {\r\n\t        this.selected = new core_1.EventEmitter();\r\n\t    }\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], ThreadListComponent.prototype, \"threads\", void 0);\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], ThreadListComponent.prototype, \"active\", void 0);\r\n\t    __decorate([\r\n\t        core_1.Output(), \r\n\t        __metadata('design:type', core_1.EventEmitter)\r\n\t    ], ThreadListComponent.prototype, \"selected\", void 0);\r\n\t    ThreadListComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'thread-list',\r\n\t            template: \"\\n  <thread-single [isActive]=\\\"active\\\" (selected)=\\\"selected.next($event)\\\" *ngFor=\\\"#item of threads\\\" [thread]=\\\"item\\\"></thread-single>\\n  \",\r\n\t            directives: [\r\n\t                thread_single_component_1.ThreadSingleComponent\r\n\t            ]\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [])\r\n\t    ], ThreadListComponent);\r\n\t    return ThreadListComponent;\r\n\t}());\r\n\texports.ThreadListComponent = ThreadListComponent;\r\n\n\n/***/ },\n\n/***/ 856:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n\t    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n\t    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n\t    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n\t};\r\n\tvar __metadata = (this && this.__metadata) || function (k, v) {\r\n\t    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n\t};\r\n\tvar core_1 = __webpack_require__(2);\r\n\tvar ThreadSingleComponent = (function () {\r\n\t    function ThreadSingleComponent() {\r\n\t        this.selected = new core_1.EventEmitter();\r\n\t    }\r\n\t    ThreadSingleComponent.prototype.onSelect = function (thread) {\r\n\t        if (this.isActive !== thread.threadId) {\r\n\t            this.selected.next(thread);\r\n\t        }\r\n\t    };\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], ThreadSingleComponent.prototype, \"thread\", void 0);\r\n\t    __decorate([\r\n\t        core_1.Input(), \r\n\t        __metadata('design:type', Object)\r\n\t    ], ThreadSingleComponent.prototype, \"isActive\", void 0);\r\n\t    __decorate([\r\n\t        core_1.Output(), \r\n\t        __metadata('design:type', core_1.EventEmitter)\r\n\t    ], ThreadSingleComponent.prototype, \"selected\", void 0);\r\n\t    ThreadSingleComponent = __decorate([\r\n\t        core_1.Component({\r\n\t            selector: 'thread-single',\r\n\t            template: \"\\n  <div class=\\\"message\\\" [ngClass]=\\\"{'is-active': isActive === thread.threadId, 'is-unread': thread.unread === true}\\\" (click)=\\\"onSelect(thread)\\\">\\n    <div class=\\\"flag flag--responsive flag--small\\\">\\n      <div class=\\\"flag__img\\\">\\n        <span class=\\\"message__inread-indicator\\\"></span>\\n        <div class=\\\"avatar avatar--medium\\\">\\n          <div class=\\\"avatar-holder\\\"\\n          [ngStyle]=\\\"{'background-image': 'url(' + thread.image + ')'}\\\">\\n          </div>\\n        </div>\\n      </div>\\n      <div class=\\\"flag__body\\\">\\n        <div class=\\\"message__name\\\">{{thread.name}}</div>\\n        <div class=\\\"message__text truncate\\\">{{thread.body}}</div>\\n        <div class=\\\"message__time\\\">{{thread.sentAt}}</div>\\n        <div class=\\\"message__total\\\" [ngClass]=\\\"{'is-visible': thread.unreadCounter > 0}\\\">{{thread.unreadCounter}}</div>\\n      </div>\\n    </div>\\n  </div>\\n  \"\r\n\t        }), \r\n\t        __metadata('design:paramtypes', [])\r\n\t    ], ThreadSingleComponent);\r\n\t    return ThreadSingleComponent;\r\n\t}());\r\n\texports.ThreadSingleComponent = ThreadSingleComponent;\r\n\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** 3.1ea87c8ca4dd8c4bb9c4.chunk.js\n **/","import {Component, Input, ChangeDetectionStrategy} from 'angular2/core';\n\nimport {MessageSingleComponent} from '../message_single/message_single.component';\n@Component({\n  selector: 'message-list',\n  template: `\n  <template ngFor #item [ngForOf]=\"messages\">\n    <div class=\"chat__time\">\n      <hr class=\"hr\">\n      <span class=\"chat__time__value\">{{item.displayDate}}</span>\n    </div>\n    <message *ngFor=\"#m of item.data\" [message]=\"m\"></message>\n  </template>\n  `,\n  directives: [\n    MessageSingleComponent\n  ]\n})\nexport class MessageListComponent {\n  @Input() messages;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/message_list/message_list.component.ts\n **/","import {Component, Input, ChangeDetectionStrategy} from 'angular2/core';\nimport {Router} from 'angular2/router';\n\n@Component({\n  selector: 'message',\n  template: `\n  <div class=\"message is-open\">\n    <div class=\"flag flag--top flag--small\">\n      <div class=\"flag__img\" (click)=\"openProfile(message.username)\">\n        <div class=\"avatar avatar--medium\">\n          <div class=\"avatar-holder\"\n          [ngStyle]=\"{'background-image': 'url(' + message.image + ')'}\">\n          </div>\n        </div>\n      </div>\n      <div class=\"flag__body\">\n        <div class=\"message__name\">\n          <span (click)=\"openProfile(message.username)\">{{message?.name}}</span>\n          <span (click)=\"openProfile(message.username)\" class=\"message__timestamp\">{{message?.time}}</span>\n        </div>\n        <div class=\"message__text\">{{message?.body}}</div>\n      </div>\n    </div>\n  </div>\n  `,\n   changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MessageSingleComponent {\n  @Input() message;\n\n  constructor(private _router: Router) {\n\n  }\n\n  openProfile(username) {\n    this._router.parent.parent.navigate(['./ProfileView', { username: username }]);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/message_single/message_single.component.ts\n **/","import {Component} from 'angular2/core';\nimport {RouteConfig, RouterLink, ROUTER_DIRECTIVES, Router, Location}\nfrom 'angular2/router';\n\n/**\n * Services\n */\nimport {InboxService} from '../../services/inbox.service';\n\n\n/**\n * Components\n */\nimport {MessagesSidebarComponent} from './messages_sidebar.component';\nimport {MessagesChatComponent} from './messages_chat.component';\nimport {MessagesNewComponent} from './messages_new.component';\nimport {MessagesSidebarHeaderComponent} from './messages_sidebar_header.component';\n\nlet view = require('./messages.html');\n@Component({\n  selector: 'message',\n  template: view,\n  directives: [\n    MessagesSidebarComponent,\n    MessagesSidebarHeaderComponent,\n    ROUTER_DIRECTIVES\n  ],\n  providers: [\n    InboxService\n  ]\n})\n@RouteConfig([\n  {\n    path: '/:threadId',\n    component: MessagesChatComponent,\n    name: 'SingleConversation'\n  },\n  {\n    path: '/new/',\n    component: MessagesNewComponent,\n    name: 'ConversationNew',\n    useAsDefault: true\n  },\n  {\n    path: '/new/:friendId',\n    component: MessagesNewComponent,\n    name: 'ConversationNewSelected',\n  }\n])\nexport class MessagesComponent {\n  counter: number = 0;\n  constructor(\n    private inboxService: InboxService,\n    private _router: Router\n    ) {\n\n  }\n\n  ngOnInit() {\n    document.body.scrollTop = document.documentElement.scrollTop = 0;\n  }\n\n  navigateToConversation(id) {\n    this._router.navigate(['SingleConversation', { threadId: id }]);\n  }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages/messages.component.ts\n **/","module.exports = \"<div class=\\\"layout layout--flush position-relative\\\">\\n  <div class=\\\"layout__item extralarge-and-up-3/10 4/10\\\">\\n    <messages-sidebar-header [counter]=\\\"counter\\\"></messages-sidebar-header>\\n    <aside class=\\\"chat-sidebar is-scrollable-y\\\" id=\\\"inbox\\\" (selected)=\\\"navigateToConversation($event)\\\">\\n    </aside>\\n  </div>\\n  <div class=\\\"layout__item extralarge-and-up-7/10 6/10\\\">\\n    <router-outlet></router-outlet>\\n  </div>\\n</div>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/app/components/messages/messages.html\n ** module id = 867\n ** module chunks = 3\n **/","import {Component, Input} from 'angular2/core';\nimport {RouteParams, Router} from 'angular2/router';\n\n/**\n * Services\n */\nimport {InboxService} from '../../services/inbox.service';\nimport {UserAuthService} from '../../services/userauth.service';\nimport {MessagesService} from '../../services/messages.service';\nimport {MessagesCounterService} from '../../services/messages_counter.service';\nimport {WebsocketService} from '../../services/websocket.service';\n\n/**\n * Components\n */\nimport {MessageListComponent} from '../message_list/message_list.component';\nimport {MessagesInputComponent} from './messages_input.component';\nimport {LoadingComponent} from '../loading/loading.component';\nimport {MessagesHeaderComponent} from '../messages_header/messages_header.component';\n\n@Component({\n  selector: 'messages-chat',\n  directives: [\n    MessagesHeaderComponent,\n    MessageListComponent,\n    MessagesInputComponent,\n    LoadingComponent\n  ],\n  providers: [\n    MessagesService,\n    UserAuthService\n  ],\n  template: `\n  <messages-header [name]=\"name\"></messages-header>\n  <div class=\"chat\">\n    <div class=\"chat-wrapper\" id=\"messages\">\n      <div class=\"chat__messages-wrapper\">\n        <div class=\"chat__messages\">\n          <loading [status]=\"loadingMessages\"></loading>\n          <message-list [messages]=\"messages\"></message-list>\n        </div>\n      </div>\n    </div>\n    <div class=\"chat__send-message\" [disabled]=\"0\" (newMessage)=\"sendMessage($event)\"></div>\n  </div>\n  `\n})\nexport class MessagesChatComponent {\n  name: string = '';\n  messages: Array<any> = [];\n  totalCount;\n  loadingMessages: boolean = false;\n  loadingMessagesFinished: boolean = false;\n  isMessagesEmpty: boolean = false;\n  messagesNext: string = '';\n  hasNew = false;\n  messagesServiceInstance;\n  websocketServiceInstance;\n  threadId;\n  scrollOffset = null;\n\n  constructor(\n    private _params: RouteParams,\n    private inboxService: InboxService,\n    private messagesService: MessagesService,\n    private userService: UserAuthService,\n    private messagesCounterService: MessagesCounterService,\n    private websocketService: WebsocketService,\n    private _router: Router\n    ) {\n    this.threadId = this._params.get('threadId');\n  }\n\n\n  ngOnInit() {\n    let url = `/api/v1/auth/user/${this.threadId}/`;\n    let channel = this.userService.findByUri(url)\n      .subscribe((data) => {\n        this.name = data.first_name;\n        channel.unsubscribe();\n      }, (err) => console.log('User could not be loaded'));\n\n    this.inboxService.select(this.threadId);\n\n    setTimeout(() => {\n      this.messagesCounterService.refreshCounter();\n    }, 500);\n\n    //subscribe to messages service updates\n    this.messagesServiceInstance = this.messagesService.serviceObserver()\n      .subscribe((res) => {\n      this.loadingMessages = res.loading;\n      this.loadingMessagesFinished = res.finished;\n      this.isMessagesEmpty = res.isEmpty;\n      this.messagesNext = res.next;\n      this.hasNew = res.hasNew;\n      // this.name = res.name;\n      let prevCount = this.messages.length;\n\n      if (res.total === 0 && res.initialLoadingFinished) {\n        this._router.parent.navigate(['/Messages', 'ConversationNewSelected', { friendId: this.threadId }]);\n      }\n\n      //when first loading messages, scroll to bottom\n      // after initial messages have been rendered\n      if (prevCount === 0 && !this.loadingMessages) {\n        let elem = jQuery('#messages')[0];\n        setTimeout(() => {\n          elem.scrollTop = elem.scrollHeight;\n        });\n      }\n\n\n\n      //if recieved new message scroll to bottom\n      if (this.hasNew && !this.loadingMessages) {\n        let elem = jQuery('#messages')[0];\n        setTimeout(() => {\n          elem.scrollTop = elem.scrollHeight;\n        });\n        this.hasNew = false;\n      }\n\n      this.messages = res.data;\n\n\n\n      //when loading more messages finishes, scroll to bottom\n      // after new messages have been rendered\n      if (prevCount > 0 && !this.loadingMessages && this.scrollOffset !== null) {\n        let elem = jQuery('#messages')[0];\n        setTimeout(() => {\n          elem.scrollTop = elem.scrollHeight - this.scrollOffset;\n          this.scrollOffset = null;\n        });\n      }\n\n      if (this.loadingMessagesFinished === false) {\n        jQuery('#messages').bind('scroll', this.handleScrollEvent.bind(this));\n      } else {\n        jQuery('#messages').unbind('scroll');\n      }\n\n    });\n\n    //start loading messages\n    this.messagesService.startLoadingMessages(this.threadId);\n\n    //subscribe to webscoket service updates\n    this.websocketServiceInstance = this.websocketService.on('messages:new').subscribe((data: any) => {\n      if (data.sender === `/api/v1/auth/user/${this.threadId}/`) {\n        this.messagesService.recievedMessage(data);\n      }\n    });\n  }\n\n  handleScrollEvent(event) {\n    //reverse scroll\n    let elem = jQuery('#messages')[0];\n    if (this.messagesNext && elem.scrollTop <= 50) {\n      if (!this.loadingMessages && !this.hasNew) {\n        this.scrollOffset = elem.scrollHeight;\n        this.messagesService.loadMore(this.threadId);\n      }\n    }\n\n  }\n\n  sendMessage(message) {\n    this.messagesService.send(this.threadId, message);\n  }\n\n  ngOnDestroy() {\n    if (this.messagesServiceInstance) {\n      this.messagesServiceInstance.unsubscribe();\n    }\n\n    if (this.websocketServiceInstance) {\n      this.websocketServiceInstance.unsubscribe();\n    }\n\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages/messages_chat.component.ts\n **/","import {Component, Input, Output, EventEmitter} from 'angular2/core';\n\n\n@Component({\n  selector: '.chat__send-message',\n  template: `\n  <div class=\"tableize\">\n    <div class=\"tableize__cell tableize__cell--fill\">\n      <div class=\"tableize__content\">\n        <textarea [(ngModel)]=\"message\" class=\"c-input c-input--large\" placeholder=\"Write a message\"></textarea>\n      </div>\n    </div>\n    <div class=\"tableize__cell\">\n      <div class=\"tableize__content chat__send-message__has-btn\">\n        <a (click)=\"sendMessage($event)\" class=\"btn btn-1 btn-1--full btn-1--filled btn-1--blue \">Send</a>\n      </div>\n    </div>\n  </div>\n  `\n})\nexport class MessagesInputComponent {\n  @Output() newMessage: EventEmitter<any> = new EventEmitter();\n  @Input() disabled;\n  message = '';\n\n  sendMessage(event) {\n    if (this.message.length > 0 && !this.disabled) {\n      this.newMessage.next(this.message);\n      this.message = '';\n    }\n\n  }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages/messages_input.component.ts\n **/","import {Component, Output, EventEmitter} from 'angular2/core';\nimport {Router, RouteParams} from 'angular2/router';\n\n/**\n * Components\n */\nimport {MessagesInputComponent} from './messages_input.component';\nimport {MessagesHeaderNewComponent} from '../messages_header_new/messages_header_new.component';\n/**\n * Services\n */\nimport {InboxService} from '../../services/inbox.service';\nimport {MessagesService} from '../../services/messages.service';\nimport {UserAuthService} from '../../services/userauth.service';\n\n@Component({\n  selector: 'messages-new',\n  template: require('./messages_new.html'),\n  directives: [\n    MessagesHeaderNewComponent,\n    MessagesInputComponent\n  ],\n  providers: [\n    MessagesService\n  ]\n})\nexport class MessagesNewComponent {\n  tokens: any[] = [];\n  initialTokens: any[] = [];\n  message: string = '';\n  friendId;\n\n  constructor(\n    private inboxService: InboxService,\n    private messagesService: MessagesService,\n    private userService: UserAuthService,\n    private _router: Router,\n    private _params: RouteParams\n  ) {\n    this.friendId = this._params.get('friendId');\n    //preselect a connection\n    if (this.friendId !== null) {\n      let uri = `/api/v1/auth/user/${this.friendId}/`;\n      let channel = this.userService.findOneByUri(uri)\n        .subscribe(data => {\n          this.initialTokens = [{\n            first_name: data.first_name,\n            image: data.image,\n            friend_id: this.friendId\n          }];\n          channel.unsubscribe();\n        }, (err) => console.log('user could not be found'));\n    }\n  }\n\n  sendMessage(message) {\n    if (this.tokens.length === 1) {\n      let channel = this.messagesService.sendNew(this.tokens[0].friend_id, message)\n        .subscribe(data => {\n          channel.unsubscribe();\n          this.inboxService.addSender(this.tokens[0].friend_id);\n          this._router.parent.navigate(['/Messages', 'SingleConversation', { threadId: this.tokens[0].friend_id }]);\n        }, error => console.log('Could not create new message.'));\n    }\n\n  }\n\n  routerOnActivate(nextInstruction, prevInstruction) {\n    this.inboxService.deselectThreads();\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages/messages_new.component.ts\n **/","module.exports = \"<messages-header-new [initialTokens]=\\\"initialTokens\\\" (selected)=\\\"tokens = $event\\\"></messages-header-new>\\n<div class=\\\"chat\\\">\\n  <div class=\\\"chat-wrapper\\\">\\n    <div class=\\\"chat__messages-wrapper\\\">\\n      <div class=\\\"chat__messages\\\">\\n        <div class=\\\"chat__messages__blank-slate\\\">\\n          <svg role=\\\"img\\\" class=\\\"icon chat-empty-state__icon\\\">\\n            <use xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xlink:href=\\\"/static/assets/icons/icons.svg#start_conversation\\\"></use>\\n          </svg>\\n          <h3 class=\\\"chat-empty-state__title\\\">Start conversation</h3>\\n          <p class=\\\"chat-empty-state__par\\\">Type your message below to start Conversation</p>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n  <div class=\\\"chat__send-message\\\" [disabled]=\\\"tokens.length === 0\\\" (newMessage)=\\\"sendMessage($event)\\\"></div>\\n</div>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/app/components/messages/messages_new.html\n ** module id = 868\n ** module chunks = 3\n **/","import {Component, Input, Output, ElementRef, EventEmitter} from 'angular2/core';\n\n/**\n * Services\n */\nimport {InboxService} from '../../services/inbox.service';\nimport {MessagesCounterService} from '../../services/messages_counter.service';\nimport {WebsocketService} from '../../services/websocket.service';\n\n/**\n * Components\n */\nimport {ThreadListComponent} from '../thread_list/thread_list.component';\nimport {LoadingComponent} from '../loading/loading.component';\n\n@Component({\n  selector: '.chat-sidebar',\n  directives: [\n    ThreadListComponent,\n    LoadingComponent\n  ],\n  template: `\n  <thread-list (selected)=\"onSelect($event)\" [active]=\"activeThread\" [threads]=\"threads\"></thread-list>\n  <loading [status]=\"loadingInbox\"></loading>\n  `\n})\nexport class MessagesSidebarComponent {\n  @Output() selected: EventEmitter<any> = new EventEmitter();\n  threads: Array<any> = [];\n  loadingInbox: boolean = false;\n  loadingInboxFinished: boolean = false;\n  isInboxEmpty: boolean = false;\n  inboxNext: string = '';\n  inboxServiceInstance;\n  websocketServiceInstance;\n  activeThread = null;\n\n  constructor(\n    private inboxService: InboxService,\n    private messagesCounterService: MessagesCounterService,\n    private websocketService: WebsocketService,\n    private element: ElementRef\n  ) {\n\n  }\n\n  ngOnInit() {\n    this.messagesCounterService.refreshCounter();\n    //subscribe to inbox service updates\n    this.inboxServiceInstance = this.inboxService.serviceObserver()\n      .subscribe((res) => {\n        this.loadingInbox = res.loading;\n        this.threads = res.data;\n        this.loadingInboxFinished = res.finished;\n        this.isInboxEmpty = res.isEmpty;\n        this.inboxNext = res.next;\n        this.activeThread = res.selected;\n\n        if (this.loadingInboxFinished === false) {\n          jQuery(this.element.nativeElement).bind('scroll', this.handleScrollEvent.bind(this));\n        } else {\n          jQuery(this.element.nativeElement).unbind('scroll');\n        }\n\n      });\n\n    //start loading inbox\n    this.inboxService.startLoadingInbox();\n\n    this.websocketServiceInstance = this.websocketService.on('messages:new').subscribe((data: any) => {\n\n      if (this.activeThread !== null) {\n        this.inboxService.markRead(this.activeThread);\n      }\n\n\n      setTimeout(() => {\n        this.inboxService.addSender(data.friend_id);\n        this.messagesCounterService.refreshCounter();\n      }, 500);\n\n    });\n\n  }\n\n  onSelect(thread) {\n    this.inboxService.select(thread.threadId);\n    this.selected.next(thread.threadId);\n  }\n\n  handleScrollEvent(event) {\n    let scrollOffset = jQuery(this.element.nativeElement).scrollTop();\n    let threshold = jQuery(document).height() - jQuery('#inbox').height() - 60;\n\n    if (this.inboxNext && scrollOffset > threshold) {\n      if (!this.loadingInbox) {\n        this.inboxService.loadMore();\n      }\n    }\n\n  }\n\n\n  ngOnDestroy() {\n    if (this.inboxServiceInstance) {\n      this.inboxServiceInstance.unsubscribe();\n    }\n    if (this.websocketServiceInstance) {\n      this.websocketServiceInstance.unsubscribe();\n    }\n\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages/messages_sidebar.component.ts\n **/","import {Component, Input} from 'angular2/core';\nimport {ROUTER_DIRECTIVES} from 'angular2/router';\n\nimport {InboxService} from '../../services/inbox.service';\n\n@Component({\n  selector: 'messages-sidebar-header',\n  directives: [\n    ROUTER_DIRECTIVES\n  ],\n  template: `\n  <header class=\"chat-sidebar-header\">\n    <div class=\"layout layout--middle\">\n      <div class=\"layout__item 3/4\">\n        <h3 class=\"chat-sidebar-header__title\">Conversation <span class=\"chat-sidebar-header__title__value\">({{counter}})</span></h3>\n      </div>\n      <div class=\"layout__item 1/4 text-right\">\n        <a [routerLink]=\"['/Messages']\" class=\"btn btn-1 btn-1--blue btn--icon-circle-small js-share mr-\">\n          <svg role=\"img\" class=\"icon icon--tiny\">\n            <use xlink:href=\"/static/assets/icons/icons.svg#icon-new-message\"></use>\n          </svg>\n        </a>\n      </div>\n    </div>\n  </header>\n  `\n})\nexport class MessagesSidebarHeaderComponent {\n  @Input() counter;\n  inboxServiceObserver;\n  constructor(private inboxService: InboxService) {\n    this.inboxServiceObserver = this.inboxService.serviceCounterObserver()\n      .subscribe(data => {\n        this.counter = data;\n      });\n  }\n\n  ngOnDestroy() {\n    this.inboxServiceObserver.unsubscribe();\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages/messages_sidebar_header.component.ts\n **/","import {Component, Input} from 'angular2/core';\n\nimport {DropdownDirective} from '../../directives/dropdown.directive';\n\n@Component({\n  selector: 'messages-header',\n  directives: [\n    DropdownDirective\n  ],\n  template: require('./messages_header.html')\n})\nexport class MessagesHeaderComponent {\n  @Input() name;\n  constructor() {\n\n  }\n\n\n  ngOnInit() {\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages_header/messages_header.component.ts\n **/","module.exports = \"<header class=\\\"chat-header\\\">\\n  <div class=\\\"layout layout--middle\\\" *ngIf=\\\"name !== ''\\\">\\n    <div class=\\\"layout__item 3/4\\\">\\n      <div class=\\\"has-input-left-labeled has-input-left-labeled--big\\\">\\n        <label class=\\\"left-labeled-label is-hidden\\\" for=\\\"\\\">To:</label>\\n        <div class=\\\"left-labeled-input\\\">\\n          <input type=\\\"text\\\" class=\\\"left-labeled-input is-hidden\\\" placeholder=\\\"NAME\\\">\\n          <span class=\\\"left-labeled-value\\\">{{name}}</span>\\n        </div>\\n      </div>\\n    </div>\\n    <div class=\\\"layout__item 1/4 text-right\\\">\\n      <div class=\\\"has-dropdown-basic\\\">\\n        <a class=\\\"btn btn-1 btn-1--red btn--icon-circle-small js-share mr\\\" dropdown=\\\"#messagesDropdown\\\">\\n          <svg role=\\\"img\\\" class=\\\"icon icon--tiny\\\">\\n            <use xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xlink:href=\\\"/static/assets/icons/icons.svg#icon-more\\\"></use>\\n          </svg>\\n        </a>\\n        <div class=\\\"dropdown-basic dropdown-basic--medium dropdown-basic--arrow-right\\\" id=\\\"messagesDropdown\\\">\\n          <ul class=\\\"list-bare\\\">\\n            <li><a>Delete conversation</a></li>\\n            <li><a>Report spam</a></li>\\n          </ul>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</header>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/app/components/messages_header/messages_header.html\n ** module id = 869\n ** module chunks = 3\n **/","import {Component, Input, Output, EventEmitter} from 'angular2/core';\nimport {findIndex} from 'lodash';\n/**\n * Components\n */\nimport {MessagesSearchConnections} from '../messages_search_connections/messages_search_connections.component';\n\n\nconst TOKEN_LIMIT: number = 1;\n\n@Component({\n  selector: 'messages-header-new',\n  directives: [\n    MessagesSearchConnections\n  ],\n  template: require('./messages_header_new.html')\n})\nexport class MessagesHeaderNewComponent {\n  @Output() selected: EventEmitter<any> = new EventEmitter;\n  @Input() initialTokens;\n  tokens: any[] = [];\n  searchInputVisible: boolean = true;\n  activeToken: number = -1;\n\n  ngOnChanges(values) {\n    if (values.initialTokens && values.initialTokens.currentValue[0]) {\n      //add initial token;\n      this.addToken(values.initialTokens.currentValue[0]);\n    }\n  }\n\n  addToken(token) {\n    //check if limit is reached\n    if (this.tokens.length < TOKEN_LIMIT) {\n      //check if token already exists\n      let i = findIndex(this.tokens, { friend_id: token.friend_id });\n      if (i === -1) {\n        this.tokens = [...this.tokens, token];\n        this.activeToken = -1;\n        this.selected.emit(this.tokens);\n      }\n      else { //make token active\n        this.activeToken = i;\n      }\n      //if token limit reached, hide search input\n      if (this.tokens.length === TOKEN_LIMIT) {\n        this.searchInputVisible = false;\n      }\n    }\n  }\n\n  removeToken(index) {\n    this.activeToken = -1;\n    this.tokens.splice(index, 1);\n    this.selected.emit(this.tokens);\n    this.searchInputVisible = true;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages_header_new/messages_header_new.component.ts\n **/","module.exports = \"<header class=\\\"chat-header has-message-drop\\\">\\n  <div class=\\\"layout layout--middle\\\">\\n    <div class=\\\"layout__item\\\">\\n      <div class=\\\"has-input-left-labeled has-input-left-labeled--big\\\">\\n        <label class=\\\"left-labeled-label\\\" for=\\\"\\\">To:&nbsp;</label>\\n        <div class=\\\"tokenfield\\\" *ngIf=\\\"tokens.length > 0\\\">\\n          <div class=\\\"token\\\" *ngFor=\\\"#token of tokens; #i = index;\\\" (click)=\\\"activeToken = i\\\" [ngClass]=\\\"{'active': activeToken === i}\\\">\\n            <span class=\\\"token-label\\\">{{token.first_name}}</span>\\n            <a (click)=\\\"removeToken(i)\\\" class=\\\"close\\\"></a>\\n          </div>\\n        </div>\\n        <div class=\\\"left-labeled-input\\\" [ngClass]=\\\"{'is-hidden': !searchInputVisible}\\\">\\n          <messages-search-connections (selected)=\\\"addToken($event)\\\"></messages-search-connections>\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</header>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/app/components/messages_header_new/messages_header_new.html\n ** module id = 870\n ** module chunks = 3\n **/","import {Component, Output, Input, EventEmitter, ElementRef} from 'angular2/core';\nimport {Control} from 'angular2/common';\nimport {Observable} from 'rxjs';\nimport {Http} from 'angular2/http';\n\ndeclare var jQuery: any;\n\n@Component({\n  selector: 'messages-search-connections',\n  template: require('./messages_search_connections.html')\n})\nexport class MessagesSearchConnections {\n  @Output() selected: EventEmitter<any> = new EventEmitter();\n  searchTerm = new Control();\n  results: Observable<any[]>;\n  resultsVisible: boolean = false;\n  selectedIndex: number = -1;\n  resultsCount: number = 0;\n  resultsCache: any[] = [];\n\n  constructor(public http: Http) {\n    this.results = this._search(this.searchTerm.valueChanges);\n  }\n\n  keyEvent(event) {\n\n    switch (event.keyCode) {\n      case 13:\n        //enter\n        if (this.selectedIndex !== -1) {\n          this.select(this.resultsCache[this.selectedIndex]);\n        }\n        break;\n      case 40:\n        //down\n        this.selectedIndex++;\n\n        if (this.selectedIndex > this.resultsCount - 1) {\n          this.selectedIndex = this.resultsCount - 1;\n        }\n\n        if (this.selectedIndex > 3) {\n          setTimeout(() => {\n            let container = jQuery('.message-drop');\n            let scrollTo = jQuery('.message-drop__results__result.is-active');\n            jQuery('.message-drop').scrollTop(\n              scrollTo.offset().top - container.offset().top + container.scrollTop()\n            );\n          });\n\n        }\n\n\n\n\n\n        break;\n      case 38:\n        //up\n        this.selectedIndex--;\n        if (this.selectedIndex < 0) {\n          this.selectedIndex = 0;\n        }\n        if (this.selectedIndex !== -1) {\n          setTimeout(() => {\n            let container = jQuery('.message-drop');\n            let scrollTo = jQuery('.message-drop__results__result.is-active');\n            jQuery('.message-drop').scrollTop(\n              scrollTo.offset().top - container.offset().top + container.scrollTop()\n            );\n          });\n\n        }\n        //prevent moving cursor to begining of input\n        event.preventDefault();\n        break;\n      case 27:\n        //escape\n        this.resultsVisible = false;\n        break;\n      default:\n        break;\n    }\n\n\n\n\n  }\n\n  ngOnInit() {\n\n  }\n\n  public select(result) {\n    this.resultsVisible = false;\n    this.resultsCache = [];\n    this.searchTerm.updateValue('');\n    this.selected.emit(result);\n  }\n\n  private _search(terms: Observable<string>, debounceDuration = 400): Observable<any[]> {\n    return terms.debounceTime(debounceDuration)\n      .distinctUntilChanged()\n      .switchMap((term: any) => this._rawSearch(term));\n  }\n\n  private _rawSearch(term: string): Observable<any> {\n    let url = `/api/v1/connectionssearch/?format=json&first_name=${term}`;\n    return this.http\n      .get(url)\n      .map(request => {\n        this.selectedIndex = -1;\n        let res = request.json();\n        this.resultsCache = res.objects;\n        this.resultsCount = res.meta.total_count;\n        if (this.resultsCount > 0) {\n          this.resultsVisible = true;\n        }\n        else {\n          this.resultsVisible = false;\n        }\n        return this.resultsCache;\n      });\n  }\n\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/messages_search_connections/messages_search_connections.component.ts\n **/","module.exports = \"<input (click)=\\\"resultsVisible = true\\\" (focus)=\\\"resultsVisible = true\\\" (blur)=\\\"resultsVisible = false\\\" (keydown)=\\\"keyEvent($event)\\\" [ngFormControl]=\\\"searchTerm\\\" type=\\\"text\\\" class=\\\"left-labeled-input__element js-message-to\\\" placeholder=\\\"NAME\\\">\\n<div class=\\\"message-drop\\\" [ngClass]=\\\"{'is-invisible': !resultsVisible}\\\">\\n  <div class=\\\"message-drop__results\\\">\\n    <a class=\\\"message-drop__results__result\\\" *ngFor=\\\"#result of results | async; #i = index\\\" (mouseover)=\\\"selectedIndex = i\\\" (click)=\\\"select(result)\\\" [ngClass]=\\\"{'is-active': selectedIndex === i}\\\">\\n      <div class=\\\"flag flag--small\\\">\\n        <div class=\\\"flag__img\\\">\\n          <div class=\\\"avatar avatar--medium\\\">\\n            <div class=\\\"avatar-holder\\\" [ngStyle]=\\\"{'background-image': 'url(' + result.image + ')'}\\\">>\\n            </div>\\n          </div>\\n        </div>\\n        <div class=\\\"flag__body\\\">\\n          <div class=\\\"message__name\\\">{{result.first_name}}</div>\\n        </div>\\n      </div>\\n    </a>\\n  </div>\\n</div>\\n\"\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/app/components/messages_search_connections/messages_search_connections.html\n ** module id = 871\n ** module chunks = 3\n **/","import {Component, Input, Output, ChangeDetectionStrategy, EventEmitter} from 'angular2/core';\n\n/**\n * Components\n */\nimport {ThreadSingleComponent} from '../thread_single/thread_single.component';\n\n@Component({\n  selector: 'thread-list',\n  template: `\n  <thread-single [isActive]=\"active\" (selected)=\"selected.next($event)\" *ngFor=\"#item of threads\" [thread]=\"item\"></thread-single>\n  `,\n  directives: [\n    ThreadSingleComponent\n  ]\n})\nexport class ThreadListComponent {\n  @Input() threads;\n  @Input() active;\n  @Output() selected: EventEmitter<any> = new EventEmitter();\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/thread_list/thread_list.component.ts\n **/","import {Component, Input, Output, ChangeDetectionStrategy, EventEmitter} from 'angular2/core';\n\n@Component({\n  selector: 'thread-single',\n  template: `\n  <div class=\"message\" [ngClass]=\"{'is-active': isActive === thread.threadId, 'is-unread': thread.unread === true}\" (click)=\"onSelect(thread)\">\n    <div class=\"flag flag--responsive flag--small\">\n      <div class=\"flag__img\">\n        <span class=\"message__inread-indicator\"></span>\n        <div class=\"avatar avatar--medium\">\n          <div class=\"avatar-holder\"\n          [ngStyle]=\"{'background-image': 'url(' + thread.image + ')'}\">\n          </div>\n        </div>\n      </div>\n      <div class=\"flag__body\">\n        <div class=\"message__name\">{{thread.name}}</div>\n        <div class=\"message__text truncate\">{{thread.body}}</div>\n        <div class=\"message__time\">{{thread.sentAt}}</div>\n        <div class=\"message__total\" [ngClass]=\"{'is-visible': thread.unreadCounter > 0}\">{{thread.unreadCounter}}</div>\n      </div>\n    </div>\n  </div>\n  `\n})\nexport class ThreadSingleComponent {\n  @Input() thread;\n  @Input() isActive;\n  @Output() selected: EventEmitter<any> = new EventEmitter();\n\n  onSelect(thread) {\n    if (this.isActive !== thread.threadId) {\n      this.selected.next(thread);\n    }\n\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./~/tslint-loader!./src/app/components/thread_single/thread_single.component.ts\n **/"],"sourceRoot":""}