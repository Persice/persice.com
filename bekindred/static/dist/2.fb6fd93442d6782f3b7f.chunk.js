webpackJsonp([2],{1242:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),ConversationInputComponent=function(){function ConversationInputComponent(){this.newMessage=new core_1.EventEmitter,this.message=""}return ConversationInputComponent.prototype.sendMessage=function(event){this.message.length>0&&!this.disabled&&(this.newMessage.next(this.message),this.message="")},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ConversationInputComponent.prototype,"newMessage",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],ConversationInputComponent.prototype,"disabled",void 0),ConversationInputComponent=__decorate([core_1.Component({selector:"prs-send-message",template:'\n  <div class="chat__send-message">\n    <div class="tableize">\n      <div class="tableize__cell tableize__cell--fill">\n        <div class="tableize__content">\n          <textarea [(ngModel)]="message" class="c-input c-input--large" placeholder="Write a message"></textarea>\n        </div>\n      </div>\n      <div class="tableize__cell">\n        <div class="tableize__content chat__send-message__has-btn">\n          <a (click)="sendMessage($event)" class="btn btn-1 btn-1--full btn-1--filled btn-1--blue ">Send</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  '}),__metadata("design:paramtypes",[])],ConversationInputComponent)}();exports.ConversationInputComponent=ConversationInputComponent},1216:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1242))},1243:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),directives_1=__webpack_require__(71),ConversationHeaderComponent=function(){function ConversationHeaderComponent(){}return __decorate([core_1.Input(),__metadata("design:type",Object)],ConversationHeaderComponent.prototype,"name",void 0),ConversationHeaderComponent=__decorate([core_1.Component({selector:"prs-conversation-header",directives:[directives_1.DropdownDirective],template:__webpack_require__(1270)}),__metadata("design:paramtypes",[])],ConversationHeaderComponent)}();exports.ConversationHeaderComponent=ConversationHeaderComponent},1270:function(module,exports){module.exports='<header class="chat-header">\n  <div class="layout layout--middle" *ngIf="name !== \'\'">\n    <div class="layout__item 3/4">\n      <div class="has-input-left-labeled has-input-left-labeled--big">\n        <label class="left-labeled-label is-hidden" for="">To:</label>\n        <div class="left-labeled-input">\n          <input type="text" class="left-labeled-input is-hidden" placeholder="NAME">\n          <span class="left-labeled-value">{{name}}</span>\n        </div>\n      </div>\n    </div>\n    <div class="layout__item 1/4 text-right">\n      <div class="has-dropdown-basic">\n        <a class="btn btn-1 btn-1--red btn--icon-circle-small js-share mr" dropdown="#messagesDropdown">\n          <svg role="img" class="icon icon--tiny">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/static/assets/icons/icons.svg#icon-more"></use>\n          </svg>\n        </a>\n        <div class="dropdown-basic dropdown-basic--medium dropdown-basic--arrow-right" id="messagesDropdown">\n          <ul class="list-bare">\n            <li><a>Delete conversation</a></li>\n            <li><a>Report spam</a></li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</header>\n'},1244:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),router_1=__webpack_require__(34),services_1=__webpack_require__(24),messages_list_1=__webpack_require__(1254),conversation_input_1=__webpack_require__(1216),conversation_header_component_1=__webpack_require__(1243),loading_1=__webpack_require__(40),ConversationComponent=function(){function ConversationComponent(_params,inboxService,messagesService,userService,messagesCounterService,websocketService,_router){this._params=_params,this.inboxService=inboxService,this.messagesService=messagesService,this.userService=userService,this.messagesCounterService=messagesCounterService,this.websocketService=websocketService,this._router=_router,this.name="",this.messages=[],this.loadingMessages=!1,this.loadingMessagesFinished=!1,this.isMessagesEmpty=!1,this.messagesNext="",this.hasNew=!1,this.scrollOffset=null,this.threadId=this._params.get("threadId")}return ConversationComponent.prototype.ngOnInit=function(){var _this=this,url="/api/v1/auth/user/"+this.threadId+"/",channel=this.userService.findByUri(url).subscribe(function(data){_this.name=data.first_name,channel.unsubscribe()},function(err){return console.log("User could not be loaded")});this.inboxService.select(this.threadId),setTimeout(function(){_this.messagesCounterService.refreshCounter()},500),this.messagesServiceInstance=this.messagesService.serviceObserver().subscribe(function(res){_this.loadingMessages=res.loading,_this.loadingMessagesFinished=res.finished,_this.isMessagesEmpty=res.isEmpty,_this.messagesNext=res.next,_this.hasNew=res.hasNew;var prevCount=_this.messages.length;if(0===res.total&&res.initialLoadingFinished&&_this._router.parent.navigate(["/Messages","ConversationNewSelected",{friendId:_this.threadId}]),0===prevCount&&!_this.loadingMessages){var elem_1=jQuery("#messages")[0];setTimeout(function(){elem_1.scrollTop=elem_1.scrollHeight})}if(_this.hasNew&&!_this.loadingMessages){var elem_2=jQuery("#messages")[0];setTimeout(function(){elem_2.scrollTop=elem_2.scrollHeight}),_this.hasNew=!1}if(_this.messages=res.data,prevCount>0&&!_this.loadingMessages&&null!==_this.scrollOffset){var elem_3=jQuery("#messages")[0];setTimeout(function(){elem_3.scrollTop=elem_3.scrollHeight-_this.scrollOffset,_this.scrollOffset=null})}_this.loadingMessagesFinished===!1?jQuery("#messages").bind("scroll",_this.handleScrollEvent.bind(_this)):jQuery("#messages").unbind("scroll")}),this.messagesService.startLoadingMessages(this.threadId),this.websocketServiceInstance=this.websocketService.on("messages:new").subscribe(function(data){data.sender==="/api/v1/auth/user/"+_this.threadId+"/"&&_this.messagesService.recievedMessage(data)})},ConversationComponent.prototype.handleScrollEvent=function(event){var elem=jQuery("#messages")[0];this.messagesNext&&elem.scrollTop<=50&&(this.loadingMessages||this.hasNew||(this.scrollOffset=elem.scrollHeight,this.messagesService.loadMore(this.threadId)))},ConversationComponent.prototype.sendMessage=function(message){this.messagesService.send(this.threadId,message)},ConversationComponent.prototype.ngOnDestroy=function(){this.messagesServiceInstance&&this.messagesServiceInstance.unsubscribe(),this.websocketServiceInstance&&this.websocketServiceInstance.unsubscribe()},ConversationComponent=__decorate([core_1.Component({selector:"prs-conversation",directives:[conversation_header_component_1.ConversationHeaderComponent,messages_list_1.MessagesListComponent,conversation_input_1.ConversationInputComponent,loading_1.LoadingComponent],providers:[services_1.MessagesService,services_1.UserAuthService],template:'\n  <prs-conversation-header [name]="name"></prs-conversation-header>\n  <div class="chat">\n    <div class="chat-wrapper" id="messages">\n      <div class="chat__messages-wrapper">\n        <div class="chat__messages">\n          <prs-loading [status]="loadingMessages"></prs-loading>\n          <prs-message-list [messages]="messages"></prs-message-list>\n        </div>\n      </div>\n    </div>\n    <prs-send-message [disabled]="0" (newMessage)="sendMessage($event)"></prs-send-message>\n  </div>\n  '}),__metadata("design:paramtypes",[router_1.RouteParams,services_1.InboxService,services_1.MessagesService,services_1.UserAuthService,services_1.MessagesCounterService,services_1.WebsocketService,router_1.Router])],ConversationComponent)}();exports.ConversationComponent=ConversationComponent},1245:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1244))},1246:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),router_1=__webpack_require__(34),services_1=__webpack_require__(24),ConversationsHeaderComponent=function(){function ConversationsHeaderComponent(inboxService){var _this=this;this.inboxService=inboxService,this.inboxServiceObserver=this.inboxService.serviceCounterObserver().subscribe(function(data){_this.counter=data})}return ConversationsHeaderComponent.prototype.ngOnDestroy=function(){this.inboxServiceObserver.unsubscribe()},__decorate([core_1.Input(),__metadata("design:type",Object)],ConversationsHeaderComponent.prototype,"counter",void 0),ConversationsHeaderComponent=__decorate([core_1.Component({selector:"prs-conversations-header",directives:[router_1.ROUTER_DIRECTIVES],template:'\n  <header class="chat-sidebar-header">\n    <div class="layout layout--middle">\n      <div class="layout__item 3/4">\n        <h3 class="chat-sidebar-header__title">Conversation <span class="chat-sidebar-header__title__value">({{counter}})</span></h3>\n      </div>\n      <div class="layout__item 1/4 text-right">\n        <a [routerLink]="[\'/Messages\']" class="btn btn-1 btn-1--blue btn--icon-circle-small js-share mr-">\n          <svg role="img" class="icon icon--tiny">\n            <use xlink:href="/static/assets/icons/icons.svg#icon-new-message"></use>\n          </svg>\n        </a>\n      </div>\n    </div>\n  </header>\n  '}),__metadata("design:paramtypes",[services_1.InboxService])],ConversationsHeaderComponent)}();exports.ConversationsHeaderComponent=ConversationsHeaderComponent},1247:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),services_1=__webpack_require__(24),thread_list_1=__webpack_require__(1257),loading_1=__webpack_require__(40),ConversationsComponent=function(){function ConversationsComponent(inboxService,messagesCounterService,websocketService,element){this.inboxService=inboxService,this.messagesCounterService=messagesCounterService,this.websocketService=websocketService,this.element=element,this.selected=new core_1.EventEmitter,this.threads=[],this.loadingInbox=!1,this.loadingInboxFinished=!1,this.isInboxEmpty=!1,this.inboxNext="",this.activeThread=null}return ConversationsComponent.prototype.ngOnInit=function(){var _this=this;setTimeout(function(){_this.messagesCounterService.refreshCounter()},500),this.inboxServiceInstance=this.inboxService.serviceObserver().subscribe(function(res){_this.loadingInbox=res.loading,_this.threads=res.data,_this.loadingInboxFinished=res.finished,_this.isInboxEmpty=res.isEmpty,_this.inboxNext=res.next,_this.activeThread=res.selected,_this.loadingInboxFinished===!1?jQuery("#inbox").bind("scroll",_this.handleScrollEvent.bind(_this)):jQuery("#inbox").unbind("scroll")}),this.inboxService.startLoadingInbox(),this.websocketServiceInstance=this.websocketService.on("messages:new").subscribe(function(data){null!==_this.activeThread&&_this.inboxService.markRead(_this.activeThread),setTimeout(function(){_this.inboxService.addSender(data.friend_id),_this.messagesCounterService.refreshCounter()},500)})},ConversationsComponent.prototype.onSelect=function(thread){this.inboxService.select(thread.threadId),this.selected.next(thread.threadId)},ConversationsComponent.prototype.handleScrollEvent=function(event){var scrollOffset=jQuery("#inbox").scrollTop(),threshold=jQuery(document).height()-jQuery("#inbox").height()-60;this.inboxNext&&scrollOffset>threshold&&(this.loadingInbox||this.inboxService.loadMore())},ConversationsComponent.prototype.ngOnDestroy=function(){this.inboxServiceInstance&&this.inboxServiceInstance.unsubscribe(),this.websocketServiceInstance&&this.websocketServiceInstance.unsubscribe()},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ConversationsComponent.prototype,"selected",void 0),ConversationsComponent=__decorate([core_1.Component({selector:"prs-conversations",directives:[thread_list_1.ThreadListComponent,loading_1.LoadingComponent],template:'\n    <aside class="chat-sidebar is-scrollable-y" id="inbox" (selected)="navigateToConversation($event)">\n      <prs-thread-list (selected)="onSelect($event)" [active]="activeThread" [threads]="threads"></prs-thread-list>\n      <prs-loading [status]="loadingInbox"></prs-loading>\n    </aside>\n  '}),__metadata("design:paramtypes",[services_1.InboxService,services_1.MessagesCounterService,services_1.WebsocketService,core_1.ElementRef])],ConversationsComponent)}();exports.ConversationsComponent=ConversationsComponent},1248:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1246)),__export(__webpack_require__(1247))},823:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1249))},1249:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),router_1=__webpack_require__(34),services_1=__webpack_require__(24),conversations_1=__webpack_require__(1248),conversation_1=__webpack_require__(1245),new_conversation_1=__webpack_require__(1250),MessagesComponent=function(){function MessagesComponent(inboxService,_router){this.inboxService=inboxService,this._router=_router,this.counter=0}return MessagesComponent.prototype.ngOnInit=function(){document.body.scrollTop=document.documentElement.scrollTop=0},MessagesComponent.prototype.navigateToConversation=function(id){this._router.navigate(["SingleConversation",{threadId:id}])},MessagesComponent=__decorate([core_1.Component({selector:"prs-messages",template:__webpack_require__(1271),directives:[conversations_1.ConversationsComponent,conversations_1.ConversationsHeaderComponent,router_1.ROUTER_DIRECTIVES],providers:[services_1.InboxService]}),router_1.RouteConfig([{path:"/:threadId",component:conversation_1.ConversationComponent,name:"SingleConversation"},{path:"/new/",component:new_conversation_1.NewConversationComponent,name:"ConversationNew",useAsDefault:!0},{path:"/new/:friendId",component:new_conversation_1.NewConversationComponent,name:"ConversationNewSelected"}]),__metadata("design:paramtypes",[services_1.InboxService,router_1.Router])],MessagesComponent)}();exports.MessagesComponent=MessagesComponent},1271:function(module,exports){module.exports='<div class="layout layout--flush position-relative">\n  <div class="layout__item extralarge-and-up-3/10 4/10">\n    <prs-conversations-header [counter]="counter"></prs-conversations-header>\n    <prs-conversations (selected)="navigateToConversation($event)"></prs-conversations>\n  </div>\n  <div class="layout__item extralarge-and-up-7/10 6/10">\n    <router-outlet></router-outlet>\n  </div>\n</div>\n'},1250:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1252))},1251:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),lodash_1=__webpack_require__(23),search_connections_component_1=__webpack_require__(1253),TOKEN_LIMIT=1,NewConversationHeaderComponent=function(){function NewConversationHeaderComponent(){this.selected=new core_1.EventEmitter,this.tokens=[],this.searchInputVisible=!0,this.activeToken=-1}return NewConversationHeaderComponent.prototype.ngOnChanges=function(values){values.initialTokens&&values.initialTokens.currentValue[0]&&this.addToken(values.initialTokens.currentValue[0])},NewConversationHeaderComponent.prototype.addToken=function(token){if(this.tokens.length<TOKEN_LIMIT){var i=lodash_1.findIndex(this.tokens,{friend_id:token.friend_id});-1===i?(this.tokens=this.tokens.concat([token]),this.activeToken=-1,this.selected.emit(this.tokens)):this.activeToken=i,this.tokens.length===TOKEN_LIMIT&&(this.searchInputVisible=!1)}},NewConversationHeaderComponent.prototype.removeToken=function(index){this.activeToken=-1,this.tokens.splice(index,1),this.selected.emit(this.tokens),this.searchInputVisible=!0},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],NewConversationHeaderComponent.prototype,"selected",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],NewConversationHeaderComponent.prototype,"initialTokens",void 0),NewConversationHeaderComponent=__decorate([core_1.Component({selector:"prs-new-conversation-header",directives:[search_connections_component_1.SearchConnectionsComponent],template:__webpack_require__(1272)}),__metadata("design:paramtypes",[])],NewConversationHeaderComponent)}();exports.NewConversationHeaderComponent=NewConversationHeaderComponent},1272:function(module,exports){module.exports='<header class="chat-header has-message-drop">\n  <div class="layout layout--middle">\n    <div class="layout__item">\n      <div class="has-input-left-labeled has-input-left-labeled--big">\n        <label class="left-labeled-label" for="">To:&nbsp;</label>\n        <div class="tokenfield" *ngIf="tokens.length > 0">\n          <div class="token" *ngFor="#token of tokens; #i = index;" (click)="activeToken = i" [ngClass]="{\'active\': activeToken === i}">\n            <span class="token-label">{{token.first_name}}</span>\n            <a (click)="removeToken(i)" class="close">Ã—</a>\n          </div>\n        </div>\n        <div class="left-labeled-input" [ngClass]="{\'is-hidden\': !searchInputVisible}">\n          <prs-search-connections (selected)="addToken($event)"></prs-search-connections>\n        </div>\n      </div>\n    </div>\n  </div>\n</header>\n'},1252:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),router_1=__webpack_require__(34),conversation_input_1=__webpack_require__(1216),new_conversation_header_component_1=__webpack_require__(1251),services_1=__webpack_require__(24),NewConversationComponent=function(){function NewConversationComponent(inboxService,messagesService,userService,_router,_params){var _this=this;if(this.inboxService=inboxService,this.messagesService=messagesService,this.userService=userService,this._router=_router,this._params=_params,this.tokens=[],this.initialTokens=[],this.message="",this.friendId=this._params.get("friendId"),null!==this.friendId)var uri="/api/v1/auth/user/"+this.friendId+"/",channel_1=this.userService.findOneByUri(uri).subscribe(function(data){_this.initialTokens=[{first_name:data.first_name,image:data.image,friend_id:_this.friendId}],channel_1.unsubscribe()},function(err){return console.log("user could not be found")})}return NewConversationComponent.prototype.sendMessage=function(message){var _this=this;if(1===this.tokens.length)var channel_2=this.messagesService.sendNew(this.tokens[0].friend_id,message).subscribe(function(data){channel_2.unsubscribe(),_this.inboxService.addSender(_this.tokens[0].friend_id),_this._router.parent.navigate(["/Messages","SingleConversation",{threadId:_this.tokens[0].friend_id}])},function(error){return console.log("Could not create new message.")})},NewConversationComponent.prototype.routerOnActivate=function(nextInstruction,prevInstruction){this.inboxService.deselectThreads()},NewConversationComponent=__decorate([core_1.Component({selector:"prs-new-conversation",template:__webpack_require__(1273),directives:[new_conversation_header_component_1.NewConversationHeaderComponent,conversation_input_1.ConversationInputComponent],providers:[services_1.MessagesService]}),__metadata("design:paramtypes",[services_1.InboxService,services_1.MessagesService,services_1.UserAuthService,router_1.Router,router_1.RouteParams])],NewConversationComponent)}();exports.NewConversationComponent=NewConversationComponent},1273:function(module,exports){module.exports='<prs-new-conversation-header [initialTokens]="initialTokens" (selected)="tokens = $event"></prs-new-conversation-header>\n<div class="chat">\n  <div class="chat-wrapper">\n    <div class="chat__messages-wrapper">\n      <div class="chat__messages">\n        <div class="chat__messages__blank-slate">\n          <svg role="img" class="icon chat-empty-state__icon">\n            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/static/assets/icons/icons.svg#start_conversation"></use>\n          </svg>\n          <h3 class="chat-empty-state__title">Start conversation</h3>\n          <p class="chat-empty-state__par">Type your message below to start Conversation</p>\n        </div>\n      </div>\n    </div>\n  </div>\n  <prs-send-message [disabled]="tokens.length === 0" (newMessage)="sendMessage($event)"></prs-send-message>\n</div>\n'},1253:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),common_1=__webpack_require__(264),http_1=__webpack_require__(55),directives_1=__webpack_require__(71),SearchConnectionsComponent=function(){function SearchConnectionsComponent(http){this.http=http,this.selected=new core_1.EventEmitter,this.searchTerm=new common_1.Control,this.resultsVisible=!1,this.selectedIndex=-1,this.resultsCount=0,this.resultsCache=[],this.results=this._search(this.searchTerm.valueChanges)}return SearchConnectionsComponent.prototype.keyEvent=function(event){switch(event.keyCode){case 13:-1!==this.selectedIndex&&this.select(this.resultsCache[this.selectedIndex]);break;case 40:this.selectedIndex++,this.selectedIndex>this.resultsCount-1&&(this.selectedIndex=this.resultsCount-1),this.selectedIndex>3&&setTimeout(function(){var container=jQuery(".message-drop"),scrollTo=jQuery(".message-drop__results__result.is-active");jQuery(".message-drop").scrollTop(scrollTo.offset().top-container.offset().top+container.scrollTop())});break;case 38:this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=0),-1!==this.selectedIndex&&setTimeout(function(){var container=jQuery(".message-drop"),scrollTo=jQuery(".message-drop__results__result.is-active");jQuery(".message-drop").scrollTop(scrollTo.offset().top-container.offset().top+container.scrollTop())}),event.preventDefault();break;case 27:this.resultsVisible=!1}},SearchConnectionsComponent.prototype.ngOnInit=function(){},SearchConnectionsComponent.prototype.select=function(result){this.resultsVisible=!1,this.resultsCache=[],this.searchTerm.updateValue(""),this.selected.emit(result)},SearchConnectionsComponent.prototype._search=function(terms,debounceDuration){var _this=this;return void 0===debounceDuration&&(debounceDuration=400),terms.debounceTime(debounceDuration).distinctUntilChanged().switchMap(function(term){return _this._rawSearch(term)})},SearchConnectionsComponent.prototype._rawSearch=function(term){var _this=this,url="/api/v1/connectionssearch/?format=json&first_name="+term;return this.http.get(url).map(function(request){_this.selectedIndex=-1;var res=request.json();return _this.resultsCache=res.objects,_this.resultsCount=res.meta.total_count,_this.resultsCount>0?_this.resultsVisible=!0:_this.resultsVisible=!1,_this.resultsCache})},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],SearchConnectionsComponent.prototype,"selected",void 0),SearchConnectionsComponent=__decorate([core_1.Component({selector:"prs-search-connections",template:__webpack_require__(1274),directives:[directives_1.CheckImageDirective]}),__metadata("design:paramtypes",[http_1.Http])],SearchConnectionsComponent)}();exports.SearchConnectionsComponent=SearchConnectionsComponent},1274:function(module,exports){module.exports='<input (click)="resultsVisible = true" (focus)="resultsVisible = true" (blur)="resultsVisible = false" (keydown)="keyEvent($event)" [ngFormControl]="searchTerm" type="text" class="left-labeled-input__element js-message-to" placeholder="NAME">\n<div class="message-drop" [ngClass]="{\'is-invisible\': !resultsVisible}">\n  <div class="message-drop__results">\n    <a class="message-drop__results__result" *ngFor="#result of results | async; #i = index" (mouseover)="selectedIndex = i" (click)="select(result)" [ngClass]="{\'is-active\': selectedIndex === i}">\n      <div class="flag flag--small">\n        <div class="flag__img">\n          <div class="avatar avatar--medium">\n            <div class="avatar-holder" checkimage="{{result.image}}" [suffix]="\'.56x56_q100_crop.jpg\'">\n            </div>\n          </div>\n        </div>\n        <div class="flag__body">\n          <div class="message__name">{{result.first_name}}</div>\n        </div>\n      </div>\n    </a>\n  </div>\n</div>\n'},1254:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1256))},1255:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),router_1=__webpack_require__(34),directives_1=__webpack_require__(71),MessageComponent=function(){function MessageComponent(_router){this._router=_router}return MessageComponent.prototype.openProfile=function(username){this._router.parent.parent.navigate(["./ProfileView",{username:username}])},__decorate([core_1.Input(),__metadata("design:type",Object)],MessageComponent.prototype,"message",void 0),MessageComponent=__decorate([core_1.Component({selector:"prs-message",directives:[directives_1.CheckImageDirective],template:'\n  <div class="message is-open">\n    <div class="flag flag--top flag--small">\n      <div class="flag__img" (click)="openProfile(message.username)">\n        <div class="avatar avatar--medium">\n          <div class="avatar-holder"\n           checkimage="{{message.image}}" [suffix]="\'.56x56_q100_crop.jpg\'">\n          </div>\n        </div>\n      </div>\n      <div class="flag__body">\n        <div class="message__name">\n          <span (click)="openProfile(message.username)">{{message?.name}}</span>\n          <span (click)="openProfile(message.username)" class="message__timestamp">{{message?.time}}</span>\n        </div>\n        <div class="message__text">{{message?.body}}</div>\n      </div>\n    </div>\n  </div>\n  ',
changeDetection:core_1.ChangeDetectionStrategy.OnPush}),__metadata("design:paramtypes",[router_1.Router])],MessageComponent)}();exports.MessageComponent=MessageComponent},1256:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),message_component_1=__webpack_require__(1255),MessagesListComponent=function(){function MessagesListComponent(){}return __decorate([core_1.Input(),__metadata("design:type",Object)],MessagesListComponent.prototype,"messages",void 0),MessagesListComponent=__decorate([core_1.Component({selector:"prs-message-list",template:'\n  <template ngFor #item [ngForOf]="messages">\n    <div class="chat__time">\n      <hr class="hr">\n      <span class="chat__time__value">{{item.displayDate}}</span>\n    </div>\n    <prs-message *ngFor="#m of item.data" [message]="m"></prs-message>\n  </template>\n  ',directives:[message_component_1.MessageComponent]}),__metadata("design:paramtypes",[])],MessagesListComponent)}();exports.MessagesListComponent=MessagesListComponent},1257:function(module,exports,__webpack_require__){"use strict";function __export(m){for(var p in m)exports.hasOwnProperty(p)||(exports[p]=m[p])}__export(__webpack_require__(1258))},1258:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),thread_component_1=__webpack_require__(1259),ThreadListComponent=function(){function ThreadListComponent(){this.selected=new core_1.EventEmitter}return __decorate([core_1.Input(),__metadata("design:type",Object)],ThreadListComponent.prototype,"threads",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],ThreadListComponent.prototype,"active",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ThreadListComponent.prototype,"selected",void 0),ThreadListComponent=__decorate([core_1.Component({selector:"prs-thread-list",template:'\n  <prs-thread [isActive]="active" (selected)="selected.next($event)" *ngFor="#item of threads" [thread]="item"></prs-thread>\n  ',directives:[thread_component_1.ThreadComponent]}),__metadata("design:paramtypes",[])],ThreadListComponent)}();exports.ThreadListComponent=ThreadListComponent},1259:function(module,exports,__webpack_require__){"use strict";var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},core_1=__webpack_require__(3),directives_1=__webpack_require__(71),ThreadComponent=function(){function ThreadComponent(){this.selected=new core_1.EventEmitter}return ThreadComponent.prototype.onSelect=function(thread){this.isActive!==thread.threadId&&this.selected.next(thread)},__decorate([core_1.Input(),__metadata("design:type",Object)],ThreadComponent.prototype,"thread",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],ThreadComponent.prototype,"isActive",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],ThreadComponent.prototype,"selected",void 0),ThreadComponent=__decorate([core_1.Component({selector:"prs-thread",directives:[directives_1.CheckImageDirective],template:'\n  <div class="message" [ngClass]="{\'is-active\': isActive === thread.threadId, \'is-unread\': thread.unread === true}" (click)="onSelect(thread)">\n    <div class="flag flag--responsive flag--small">\n      <div class="flag__img">\n        <span class="message__inread-indicator"></span>\n        <div class="avatar avatar--medium">\n          <div class="avatar-holder"\n          checkimage="{{thread.image}}" [suffix]="\'.56x56_q100_crop.jpg\'">\n          </div>\n        </div>\n      </div>\n      <div class="flag__body">\n        <div class="message__name">{{thread.name}}</div>\n        <div class="message__text truncate">{{thread.body}}</div>\n        <div class="message__time">{{thread.sentAt}}</div>\n        <div class="message__total" [ngClass]="{\'is-visible\': thread.unreadCounter > 0}">{{thread.unreadCounter}}</div>\n      </div>\n    </div>\n  </div>\n  '}),__metadata("design:paramtypes",[])],ThreadComponent)}();exports.ThreadComponent=ThreadComponent}});
//# sourceMappingURL=2.fb6fd93442d6782f3b7f.bundle.map